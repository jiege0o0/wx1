function sendClientError(t){Net.send(GameEvent.sys.client_error,{msg:UM.gameid+":"+t},null,!1)}var egret=window.egret,__reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);i.prototype=e.prototype,t.prototype=new i},__awaiter=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))(function(r,o){function s(t){try{h(n.next(t))}catch(e){o(e)}}function a(t){try{h(n["throw"](t))}catch(e){o(e)}}function h(t){t.done?r(t.value):new i(function(e){e(t.value)}).then(s,a)}h((n=n.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function i(t){return function(e){return n([t,e])}}function n(i){if(r)throw new TypeError("Generator is already executing.");for(;h;)try{if(r=1,o&&(s=o[2&i[0]?"return":i[0]?"throw":"next"])&&!(s=s.call(o,i[1])).done)return s;switch(o=0,s&&(i=[0,s.value]),i[0]){case 0:case 1:s=i;break;case 4:return h.label++,{value:i[1],done:!1};case 5:h.label++,o=i[1],i=[0];continue;case 7:i=h.ops.pop(),h.trys.pop();continue;default:if(s=h.trys,!(s=s.length>0&&s[s.length-1])&&(6===i[0]||2===i[0])){h=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){h.label=i[1];break}if(6===i[0]&&h.label<s[1]){h.label=s[1],s=i;break}if(s&&h.label<s[2]){h.label=s[2],h.ops.push(i);break}s[2]&&h.ops.pop(),h.trys.pop();continue}i=e.call(t,h)}catch(n){i=[6,n],o=0}finally{r=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var r,o,s,a,h={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},game;!function(t){var e=function(t){function e(e){var i=t.call(this)||this;return e&&(i.skinName=e),i}return __extends(e,t),e.prototype.childrenCreated=function(){},e.prototype.partAdded=function(e,i){t.prototype.partAdded.call(this,e,i),i.id=e,i instanceof eui.Image?e.toLowerCase().indexOf("btn")>-1||(i.touchEnabled=!1):i instanceof eui.Label&&(i.touchEnabled=!1)},e.prototype.setHtml=function(t,e){t.textFlow=(new egret.HtmlTextParser).parser(e)},e.prototype.addBtnEvent=function(t,e,i){t.touchEnabled=!0,t.addEventListener(egret.TouchEvent.TOUCH_TAP,e,i||this);var n=(t.id||"").toLocaleLowerCase();(-1!=n.indexOf("btn")||-1!=n.indexOf("button"))&&SoundManager.getInstance().addBtnClickEffect(t)},e.prototype.createHtml=function(t,e,i){return MyTool.createHtml(t,e,i)},e.prototype.removeBtnEvent=function(t,e,i){t.removeEventListener(egret.TouchEvent.TOUCH_TAP,e,i||this)},e.prototype.clearList=function(t){var e=t;t instanceof eui.List&&(e=[t]);for(var i in e)try{e[i].dataProvider=null,e[i].dataProviderRefreshed()}catch(n){}this.validateNow()},e}(eui.Component);t.BaseContainer=e,__reflect(e.prototype,"game.BaseContainer");var i=function(t){function e(e){var i=t.call(this)||this;return i.isStartLoad=!1,i.BaseTypeList=[],i.isInitUI=!0,i.sizeList=[],i.isWindow=!1,i.noMV=!1,i.isHideFlag=!0,i.canBGClose=!1,i.loadData=null,i.loadUI=null,i.hideBehind=!0,i.showFinishFunList=[],i.panelEvents={},i.isWindow=e,i.isWindow||GameManager.stage.addEventListener(egret.Event.RESIZE,i.onResize,i),i}return __extends(e,t),e.prototype.childrenCreated=function(){this.isInitUI=!0,this.isWindow||this.onResize(null)},e.prototype.createComplete=function(t){this.removeEventListener(egret.Event.ENTER_FRAME,this.createComplete,this),this._arguments?this.onShow.apply(this,this._arguments):this.onShow(),this.runShowFinish()},e.prototype.runShowFinish=function(){for(;this.showFinishFunList.length>0;)this.showFinishFunList.shift()()},e.prototype.addShowFinishFun=function(t){this.showFinishFunList.push(t)},e.prototype.partAdded=function(e,i){t.prototype.partAdded.call(this,e,i)},e.prototype.addPanelOpenEvent=function(t,e){this.panelEvents[t]=e,EM.addEvent(t,e,this)},e.prototype.addListenerSizeY=function(t){for(;t.length>0;)this.sizeList.push({ui:t.pop(),type:"y"})},e.prototype.addListenerSizeH=function(t){for(;t.length>0;)this.sizeList.push({ui:t.pop(),type:"h"})},e.prototype.resizeFun=function(){},e.prototype.onVisibleChange=function(){},e.prototype.onResize=function(t){this.height=GameManager.stage.stageHeight;for(var e=0;e<this.sizeList.length;e++);this.parent&&this.resizeFun()},e.prototype.cacheFunArguments=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._arguments=t},e.prototype.onShow=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this},e.prototype.show=function(){if(this.LoadFiles&&this.LoadFiles.length>0){if(this.isStartLoad)return;return this.isStartLoad=!0,LoadingFile.getInstance().loadGroup(this.LoadFiles,this.showFun,this,this.loadUI,this.loadData),void(this.LoadFiles=[])}return this.showFun(),this},e.prototype.showFun=function(){if(this.isStartLoad=!1,this.BaseTypeList)for(var t=0;t<this.BaseTypeList.length;t++){var i=this.BaseTypeList[t];e.UIshowList[i]||(e.UIshowList[i]=[]),-1==e.UIshowList[i].indexOf(this)&&e.UIshowList[i].push(this)}PopUpManager.addPopUp(this,this.isWindow,this.noMV),this.isInitUI&&(this.isHideFlag=!1,this._arguments?this.onShow.apply(this,this._arguments):this.onShow(),this.runShowFinish()),e.setStopEevent()},e.prototype.isHide=function(){return this.isHideFlag},e.prototype.hide=function(){this.beforeHide();for(var t in this.panelEvents)EM.removeEvent(t,this.panelEvents[t],this);if(this.BaseTypeList)for(var i=0;i<this.BaseTypeList.length;i++){var n=this.BaseTypeList[i],r=e.UIshowList[n];if(r)for(var o=r.length-1;o>=0;o--)r[o]==self&&r.splice(o,1)}return this.isHideFlag=!0,PopUpManager.removePopUp(this),this},e.prototype.onAddToStage=function(t){console.log(222)},Object.defineProperty(e,"isStopEevent",{get:function(){return Date.now()-e.openTime<400},enumerable:!0,configurable:!0}),e.setStopEevent=function(){e.openTime=Date.now()},e.prototype.paySound=function(t,e){},e.prototype.beforeHide=function(){},e.UIshowList={},e.hideType=function(t){var i=e.UIshowList[t];if(i)for(var n=i.length-1;n>=0;n--)i[n].hide()},e}(t.BaseContainer);t.BaseUI=i,__reflect(i.prototype,"game.BaseUI");var n=function(t){function e(){var e=t.call(this,!0)||this;return e.canBGClose=!0,e}return __extends(e,t),e.prototype.setTitle=function(t,e){var i=this.getChildAt(0);i.setTitle(t),e&&i.setBottomHeight(e)},e}(t.BaseUI);t.BaseWindow=n,__reflect(n.prototype,"game.BaseWindow");var r=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.partAdded=function(e,i){t.prototype.partAdded.call(this,e,i),i.id=e,i instanceof eui.Image?e.toLowerCase().indexOf("btn")>-1||(i.touchEnabled=!1):i instanceof eui.Label&&(i.touchEnabled=!1)},e.prototype.setHtml=function(t,e){t.textFlow=(new egret.HtmlTextParser).parser(e)},e.prototype.addBtnEvent=function(t,e,i){if(t.touchEnabled=!0,t.addEventListener(egret.TouchEvent.TOUCH_TAP,e,this),!i){var n=(t.id||"").toLocaleLowerCase();(-1!=n.indexOf("btn")||-1!=n.indexOf("button"))&&SoundManager.getInstance().addBtnClickEffect(t)}},e.prototype.createHtml=function(t,e,i){return MyTool.createHtml(t,e,i)},e.prototype.removeBtnEvent=function(t,e,i){t.removeEventListener(egret.TouchEvent.TOUCH_TAP,e,i||this)},e}(eui.ItemRenderer);t.BaseItem=r,__reflect(r.prototype,"game.BaseItem")}(game||(game={}));var CarManager=function(){function t(){this.maxLevel=_get.level||0,this.skinid=1,this.levelData={1:2e4},this.skins=[1,2],this.skinsData={},this.maxLevel=ObjectUtil.objLength(this.levelData)}return t.getInstance=function(){return this.instance||(this.instance=new t),this.instance},t.prototype.initData=function(t){this.skinid=t.skinid,this.levelData=t.levelData,this.skins=t.skins,this.skinsData=t.skinsData||{},this.maxLevel=ObjectUtil.objLength(this.levelData)},t.prototype.getLevelStar=function(t){var e=this.getLevelCD(t);return e?GameData.getInstance().getStarByLevel(t,e):0},t.prototype.getAllStar=function(){var t=0;for(var e in this.levelData)t+=this.getLevelStar(e);return t},t.prototype.getLevelCD=function(t){return this.levelData[t]||0},t.prototype.isHaveSkin=function(t){return-1!=this.skins.indexOf(t)},t.prototype.getSkinValue=function(t){var e=GameData.getInstance().carData[t];switch(e.buyType){case 0:break;case 1:return this.maxLevel;case 2:return(TM.now()-(this.skinsData.time||0))/3600;case 3:return ObjectUtil.objLength(this.skinsData[t]||{});case 4:return this.skinsData[t]||0}return 0},t.prototype.sendSuccess=function(t,e){var i=this,n=GameData.getInstance(),r=this.getLevelCD(n.level);if(SharedObjectManager.getInstance().removeMyValue("chapter"+n.level),this.upWXData(),!r||r>t){var o={};o[n.level]=t;var s=this.getAllStar();return void WXDB.updata("user",{levelData:o},function(){i.levelData[n.level]=t,i.maxLevel=ObjectUtil.objLength(i.levelData),s!=i.getAllStar()&&i.upWXData(),e&&e()})}e&&e()},t.prototype.setCarSkin=function(t,e){this.skinid=t,GameUI.getInstance().renewCar(),WXDB.updata("user",{skinid:t},function(){e&&e()})},t.prototype.buySkin=function(t,e){var i=this,n=this.skins.concat(t),r=TM.now();WXDB.updata("user",{skins:n,skinsData:{time:r}},function(){i.skins.push(t),i.skinsData.time=r,EM.dispatch(GameEvent.client.SKIN_CHANGE),e&&e()})},t.prototype.upWXData=function(){var t=window.wx;t&&t.setUserCloudStorage({KVDataList:[{key:"score",value:this.getAllStar()+","+TM.now()}],success:function(t){console.log(t)},fail:function(t){console.log(t)}})},t}();__reflect(CarManager.prototype,"CarManager");var UM,TM,EM,Main=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isThemeLoadEnd=!1,e.isResourceLoadEnd=!1,e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),console.log("_10");var e=new AssetAdapter;this.stage.registerImplementation("eui.IAssetAdapter",e),this.stage.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.setScaleMode(),this.loadingView=MainLoadingUI.getInstance(),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/"),UM=UserManager.getInstance(),TM=TimeManager.getInstance(),EM=EventManager.getInstance(),Config.initURLRequest(),console.log("_1a")},e.prototype.setScaleMode=function(){},e.prototype.onConfigComplete=function(t){console.log("_1b"),RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this);var e=new eui.Theme("resource/default.thm.json",this.stage);e.addEventListener(eui.UIEvent.COMPLETE,this.onThemeLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("game")},e.prototype.onThemeLoadComplete=function(){this.isThemeLoadEnd=!0,console.log("_1c"),this.createScene()},e.prototype.onResourceLoadComplete=function(t){console.log("_1d"),"game"==t.groupName&&(this.isResourceLoadEnd=!0,this.removeLoadEvent(),this.createScene())},e.prototype.removeLoadEvent=function(){this.loadingView.setFinish(),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this)},e.prototype.createScene=function(){this.isThemeLoadEnd&&this.isResourceLoadEnd&&this.startCreateScene()},e.prototype.onItemLoadError=function(t){console.warn("Url:"+t.resItem.url+" has failed to load")},e.prototype.onResourceLoadError=function(t){console.warn("Group:"+t.groupName+" has failed to load"),this.onResourceLoadComplete(t)},e.prototype.onResourceProgress=function(t){console.log(t.itemsLoaded,t.itemsTotal),"game"==t.groupName&&this.loadingView.setProgress(t.itemsLoaded,t.itemsTotal)},e.prototype.startCreateScene=function(){GameManager.stage=this.stage,GameManager.container=this,GameManager.getInstance().init(),console.log("_11");var t=window.wx;return t?(console.log("_12"),void UserManager.getInstance().getUserInfo(function(){GameUI.getInstance().show()})):void GameUI.getInstance().show()},e}(eui.UILayer);__reflect(Main.prototype,"Main");var MainLoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.getInstance=function(){return this.instance||(this.instance=new e),this.instance},e.prototype.createView=function(){this.shape=new eui.Rect,this.shape.width=640,this.shape.fillColor=0,this.shape.touchEnabled=!0,this.addChild(this.shape),this.textField=new eui.Label,this.addChild(this.textField),this.textField.x=80,this.textField.width=480,this.textField.height=100,this.textField.text="Loading...",this.textField.textAlign="center",this.icon=new eui.Image,this.addChild(this.icon),this.icon.x=230},e.prototype.show=function(t){t.addChild(this),this.width=640,this.height=t.stage.stageHeight,this.shape.height=t.stage.stageHeight,this.textField.y=this.height/2,this.icon.y=this.textField.y-230,this.textField.text="Loading..."},e.prototype.setFinish=function(){this.textField.text="加载完成，正在初始化...."},e.prototype.showLogin=function(){this.textField.text="登陆中...."},e.prototype.setProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e.prototype.hide=function(){MyTool.removeMC(this)},e}(egret.Sprite);__reflect(MainLoadingUI.prototype,"MainLoadingUI");var MsgingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Config.isDebug&&MyWindow.Alert(Net.getInstance().actionRecord.join("\n"))},e),e}return __extends(e,t),e.getInstance=function(){return this.instance||(this.instance=new e),this.instance},e.getInstance2=function(){return this.instance2||(this.instance2=new e),this.instance2},e.prototype.createView=function(){this.shape=new eui.Rect,this.shape.width=640,this.shape.fillColor=0,this.shape.fillAlpha=.3,this.shape.touchEnabled=!0,this.addChild(this.shape),this.loadingMC=new eui.Image,this.loadingMC.source="ui_loading_png",this.addChild(this.loadingMC),this.loadingMC.x=320,this.loadingMC.anchorOffsetX=35,this.loadingMC.anchorOffsetY=35},e.prototype.show=function(){this.showTimer=egret.getTimer(),GameManager.container.addChild(this),this.width=640,this.height=GameManager.stage.stageHeight,this.shape.height=GameManager.stage.stageHeight,this.loadingMC.y=this.height/2-100,egret.Tween.removeTweens(this.loadingMC);var t=egret.Tween.get(this.loadingMC,{loop:!0});t.to({rotation:0}).to({rotation:360},1e3),this.alpha=0,egret.clearTimeout(this.timer),this.timer=egret.setTimeout(function(){this.alpha=1},this,200)},e.prototype.hide=function(){egret.Tween.removeTweens(this.loadingMC),MyTool.removeMC(this)},e}(egret.Sprite);__reflect(MsgingUI.prototype,"MsgingUI");var DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t.prototype.shareMessage=function(t,e,i,n,r){},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var ThemeAdapter=function(){function t(){}return t.prototype.getTheme=function(t,e,i,n){function r(t){e.call(n,t)}function o(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,o,null),i.call(n))}var s=this;if("undefined"!=typeof generateEUI)egret.callLater(function(){e.call(n,generateEUI)},this);else if("undefined"!=typeof generateEUI2)RES.getResByUrl("resource/gameEui.json",function(t,i){window.JSONParseClass.setData(t),egret.callLater(function(){e.call(n,generateEUI2)},s)},this,RES.ResourceItem.TYPE_JSON);else if("undefined"!=typeof generateJSON)if(t.indexOf(".exml")>-1){var a=t.split("/");a.pop();var h=a.join("/")+"_EUI.json";generateJSON.paths[t]?egret.callLater(function(){e.call(n,generateJSON.paths[t])},this):RES.getResByUrl(h,function(i){window.JSONParseClass.setData(i),egret.callLater(function(){e.call(n,generateJSON.paths[t])},s)},this,RES.ResourceItem.TYPE_JSON)}else egret.callLater(function(){e.call(n,generateJSON)},this);else RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,o,null),RES.getResByUrl(t,r,this,RES.ResourceItem.TYPE_TEXT)},t}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var AssetAdapter=function(){function t(){}return t.prototype.getAsset=function(t,e,i){function n(n){e.call(i,n,t)}if(RES.hasRes(t)){var r=RES.getRes(t);r?n(r):RES.getResAsync(t,n,this)}else RES.getResByUrl(t,n,this,RES.ResourceItem.TYPE_IMAGE)},t}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var Config=function(){function t(){}return t.init=function(){},t.createImg=function(t,e){return void 0===e&&(e=""),{name:t.replace(".","_"),type:"image",url:e+t}},t.createJSON=function(t,e){return void 0===e&&(e=""),{name:t.replace(".","_"),type:"json",url:e+t}},t.initURLRequest=function(){var t=location.hash||location.search||"",e=location.hash?"#":"?";if(-1!=t.indexOf(e))for(var i=t.substr(1),n=i.split("&"),r=0;r<n.length;r++)_get[n[r].split("=")[0]]=decodeURIComponent(n[r].split("=")[1])},t.isDebug=!0,t.userHost="hangegame.com",t.host="hangegame.com",t.pkServerHost="172.17.196.195",t.pkServerPose=9029,t.serverID=1,t.user_version=1,t.version=1,t.displayVersion="1.0.0",t.pk_version=1,t.cdn="",t.localResRoot="resource/game_assets/",t.slaveLevel=10,t.activeLevel=20,t.pvpLevel=15,t.heroLevel=50,t.platform="",t.platformGameidAdd="",t.equalValue=1e3,t}();__reflect(Config.prototype,"Config");var _get=function(){function t(){}return t}();__reflect(_get.prototype,"_get");var GameEvent=function(){function t(){}return t.client={SKIN_CHANGE:"SKIN_CHANGE",INFO_CHANGE:"INFO_CHANGE",red_change:"red_change",pass_day:"pass_day",timer:"timer"},t.sys={login:"login",client_error:"sys.client_error"},t.game={buy_skin:"game.buy_skin",create_rank:"rank.create_rank",get_rank2:"rank.get_rank2"},t.rank={get_rank:"rank.get_rank",create_rank:"rank.create_rank",get_rank2:"rank.get_rank2"},t}();__reflect(GameEvent.prototype,"GameEvent");var MovieSimpleMC=function(t){function e(e,i,n,r){var o=t.call(this)||this;return o.current=0,o.sleepFrame=0,o.icon=e,o.setList(i),o.sleepFrame=r||0,o.currSleep=0,o.timeID=new egret.Timer(n||42,0),o.timeID.addEventListener(egret.TimerEvent.TIMER,o.updateTime,o),o}return __extends(e,t),Object.defineProperty(e.prototype,"isPlaying",{get:function(){return this.timeID.running},enumerable:!0,configurable:!0}),e.prototype.setList=function(t){this.list=t,this.max=t.length},e.prototype.play=function(){return 1==this.list.length?(this.icon.source=this.list[0],void this.stop()):(this.currSleep=0,this.timeID.start(),this)},e.prototype.stop=function(){this.timeID.stop()},e.prototype.gotoAndPlay=function(t){void 0===t&&(t=0),this.current=t,this.isOnce=!1,this.times=0,this.icon.source=this.list[this.current],this.play()},e.prototype.gotoAndPlayOnce=function(t){void 0===t&&(t=0),this.current=t,this.isOnce=!0,this.times=0,this.icon.source=this.list[this.current],this.play()},e.prototype.gotoAndPlayTimes=function(t){void 0===t&&(t=1),this.current=0,this.isOnce=!1,this.times=t,this.icon.source=this.list[this.current],this.play()},e.prototype.updateTime=function(){return 0!=this.sleepFrame&&this.currSleep>0?void(++this.currSleep==this.sleepFrame&&(this.currSleep=0)):(this.icon.source=this.list[this.current],void(++this.current==this.max&&(this.current=0,this.currSleep=1,this.isOnce?(this.dispatchEventWith("complete"),this.stop()):this.times>0&&(this.times--,0==this.times&&(this.dispatchEventWith("complete"),this.stop())))))},e.prototype.dispose=function(){this.stop()},e.prototype.setAutoDispose=function(){this.icon.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.dispose,this)},e}(egret.EventDispatcher);__reflect(MovieSimpleMC.prototype,"MovieSimpleMC");var MovieSimpleMC2=function(t){function e(){var e=t.call(this)||this;return e.current=0,e.touchEnabled=e.touchChildren=!1,e}return __extends(e,t),e.prototype.setData=function(t,e,i,n,r,o){return this.icon=t,"string"==typeof t&&(this.icon=new eui.Image(t)),this.addChild(this.icon),this.iconWidth=e,this.iconHeight=i,this.max=n,this.timeID||(this.timeID=new egret.Timer(r||42,0),this.timeID.addEventListener(egret.TimerEvent.TIMER,this.updateTime,this)),this.playTimes=o||0,this.isLoop=0==this.playTimes?!0:!1,this.reSet(),this},e.prototype.reSetSource=function(t){this.icon&&(this.icon.source=t)},e.prototype.setXY=function(t){t.x&&(this.x=t.x),t.y&&(this.y=t.y),t.scaleX&&(this.scaleX=t.scaleX),t.scaleY&&(this.scaleY=t.scaleY)},e.prototype.play=function(){this.timeID.start()},e.prototype.stop=function(){this.timeID.stop()},e.prototype.reSet=function(){this.now_playTimes=0},e.prototype.gotoAndPay=function(t){this.current=t-1,this.icon.scrollRect=new egret.Rectangle(this.current*this.iconWidth,0,this.iconWidth,this.iconHeight),this.play()},e.prototype.gotoAndStop=function(t){this.current=t-1,this.icon.scrollRect=new egret.Rectangle(this.current*this.iconWidth,0,this.iconWidth,this.iconHeight)},e.prototype.updateTime=function(){this.icon.scrollRect=new egret.Rectangle(this.current*this.iconWidth,0,this.iconWidth,this.iconHeight),++this.current==this.max&&(this.current=0,this.isLoop||++this.now_playTimes==this.playTimes&&(this.stop(),this.dispatchEventWith("stop")))},e.prototype.dispose=function(){this.stop(),this.timeID.removeEventListener(egret.TimerEvent.TIMER,this.updateTime,this),this.timeID=null},e}(egret.DisplayObjectContainer);__reflect(MovieSimpleMC2.prototype,"MovieSimpleMC2");var MyTimer=function(t){function e(e){var i=t.call(this)||this;return i.cd=0,i.lastTime=0,i.cd=e,i.timer=new egret.Timer(e),i.timer.addEventListener(egret.TimerEvent.TIMER,i.onE,i),i}return __extends(e,t),e.prototype.onE=function(){for(var t=Math.floor((egret.getTimer()-this.lastTime)/this.cd);t--;)this.dispatchEventWith(egret.TimerEvent.TIMER),this.lastTime+=this.cd},e.prototype.start=function(){this.timer.start(),this.lastTime=egret.getTimer()},e.prototype.stop=function(){this.timer.stop()},e}(egret.EventDispatcher);__reflect(MyTimer.prototype,"MyTimer");var MyTool=function(){function t(){}return t.getPropCoin=function(){return Config.localResRoot+"prop/prop_coin.png"},t.getPropEnergy=function(){return Config.localResRoot+"prop/prop_energy.png"},t.getPropBox=function(t){var e=Math.ceil(t/4);return Config.localResRoot+"prop/box_r"+e+".png"},t.getSkillBox=function(t){return Config.localResRoot+"prop/box_s"+t+".png"},t.getHeroBox=function(t){return Config.localResRoot+"prop/box_h"+t+".png"},t.getPropLevel=function(){return Config.localResRoot+"prop/prop_level.png"},t.getPropHang=function(){return"icon_atk3_png"},t.getPropDiamond=function(){return Config.localResRoot+"prop/prop_diamond.png"},t.getPropFight=function(){return Config.localResRoot+"prop/prop_fight.png"},t.getAwardArr=function(e){var i=[];return e.offline_value&&i.push({name:"竞技场积分",num:(e.offline_value>0?"+":"")+e.offline_value}),e.coin&&i.push({img:t.getPropCoin(),name:"金币",num:"×"+NumberUtil.addNumSeparator(e.coin),num2:e.coin}),e.diamond&&i.push({img:t.getPropDiamond(),name:"钻石",num:"×"+NumberUtil.addNumSeparator(e.diamond)}),e.fightvalue&&i.push({img:t.getPropFight(),name:"远征秘石",num:"×"+NumberUtil.addNumSeparator(e.fightvalue)}),e.energy&&i.push({img:t.getPropEnergy(),name:" 体力",num:"×"+NumberUtil.addNumSeparator(e.energy)}),i},t.setTypeImg=function(t,e){t.source="icon_type"+e+"_png"},t.clearList=function(t){t.dataProvider=null,t.dataProviderRefreshed(),t.validateNow()},t.renewList=function(t){for(var e=0;e<t.numChildren;e++)t.getChildAt(e).dataChanged()},t.runListFun=function(t,e){for(var i=0;i<t.numChildren;i++)t.getChildAt(i)[e]()},t.removeMC=function(t){t&&t.parent&&t.parent.removeChild(t)},t.upMC=function(t){t&&t.parent&&t.parent.addChild(t)},t.getDis=function(t,e){return Math.pow(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2),.5)},t.getMiddleXY=function(t,e){return{x:t.x+(e.x-t.x)/2,y:t.y+(e.y-t.y)/2}},t.addColor=function(t,e){if(-1==e)return void(t.filters=null);var i=.8,n=35,r=35,o=2,s=3,a=!1,h=!1,c=new egret.GlowFilter(e,i,n,r,o,s,a,h);t.filters=[c]},t.changeGray=function(t,e,i){if(void 0===e&&(e=!0),i&&(t.touchChildren=t.touchEnabled=!e),!e)return void(t.filters=null);var n=[.3,.6,0,0,0,.3,.6,0,0,0,.3,.6,0,0,0,0,0,0,1,0],r=new egret.ColorMatrixFilter(n);t.filters=[r]},t.setImgSource=function(t,e){t.source!=e&&(t.visible=!1,t.once(egret.Event.COMPLETE,this.onImgComplete,this),t.source=e)},t.onImgComplete=function(t){t.currentTarget.visible=!0},t.toFixed=function(t,e){for(var i=t.toFixed(e),n=i.charAt(i.length-1);("0"==n||"."==n)&&(i=i.substr(0,i.length-1),"."!=n);)n=i.charAt(i.length-1);return i},t.resetScrollV=function(t){if(t.viewport.scrollV<0)t.viewport.scrollV=0;else{if(!(t.viewport.scrollV+t.viewport.height>t.viewport.contentHeight))return;t.viewport.scrollV=Math.max(0,t.viewport.contentHeight-t.viewport.height)}t.stopAnimation()},t.getValueChangeArray=function(t,e,i,n){void 0===n&&(n=!1);for(var r=[],o=0;i>o;o++){var s=t+(e-t)/i*(o+1);n||(s=Math.floor(s)),r.push(s)}return r},t.addLongTouch=function(t,e,i){function n(t){var n=t.stageX,s=t.stageY;GameManager.stage.removeEventListener(egret.TouchEvent.TOUCH_END,r,i),GameManager.stage.removeEventListener(egret.TouchEvent.TOUCH_CANCEL,r,i),GameManager.stage.once(egret.TouchEvent.TOUCH_END,r,i),GameManager.stage.once(egret.TouchEvent.TOUCH_CANCEL,r,i),clearTimeout(o),o=setTimeout(function(){return Math.abs(GameManager.stageX-n)>20||Math.abs(GameManager.stageY-s)>20?(GameManager.stage.removeEventListener(egret.TouchEvent.TOUCH_END,r,i),void GameManager.stage.removeEventListener(egret.TouchEvent.TOUCH_CANCEL,r,i)):void e.apply(i)},400)}function r(t){GameManager.stage.removeEventListener(egret.TouchEvent.TOUCH_END,r,i),GameManager.stage.removeEventListener(egret.TouchEvent.TOUCH_CANCEL,r,i),clearTimeout(o)}var o;t.touchEnabled=!0,t.addEventListener(egret.TouchEvent.TOUCH_BEGIN,n,i)},t.addDoubleTouch=function(t,e,i){function n(t){egret.getTimer()-r<500&&(t.stopPropagation(),e.apply(i)),r=egret.getTimer()}t.addEventListener(egret.TouchEvent.TOUCH_TAP,n,i,!1,100);var r=-1},t.setHtml=function(t,e){t.textFlow=(new egret.HtmlTextParser).parser(e)},t.setColorText=function(t,e,i){i=i||"#FFDE93",e=e.replace(/\[/g,'<font color="'+i+'">'),e=e.replace(/\]/g,"</font>"),this.setHtml(t,e)},t.myHitTest=function(t,e,i){var n=t.localToGlobal(0,0),r=t.localToGlobal(t.width,t.height);return n.x<e&&e<r.x&&n.y<i&&i<r.y},t.changeToChinese=function(t){for(var e=String(t),i=["","一","二","三","四","五","六","七","八","九"],n=["十","百","千","万"],r="",o=e.split(""),s=0,a=o.length-1;a>=0;a--)r=i[o[a]]+r,0!=a&&(r=n[s]+r,s++);return r},t.addTestBlock=function(t){var e=new egret.Sprite;return t.addChild(e),e.graphics.beginFill(0),e.graphics.drawRect(0,0,10,10),e.graphics.endFill(),e},t.str2Num=function(t){var e=t.charCodeAt(0);return 58>e?e-48:91>e?e-55:e-61},t.replaceEmoji=function(t){var e=["�[�-�]","�[�-�]","�[�-�]"];return t.replace(new RegExp(e.join("|"),"g"),"")},t.getBtnPath=function(t){if(!t)return"";var e=[];for(t.id&&e.push(t.id);t.parent;)t.parent.id?e.unshift(t.parent.id):t.parent.skinName&&e.unshift(t.parent.skinName),t=t.parent;return e.join(".")},t.refresh=function(){location.reload()},t.createHtml=function(t,e,i){var n="";return void 0!=e&&(n+='color="'+e+'"'),void 0!=i&&(n+=' size="'+i+'"'),"<font "+n+">"+t+"</font>"},t.stopClick=function(t){GameManager.container.touchChildren=GameManager.container.touchEnabled=!1,setTimeout(function(){GameManager.container.touchChildren=GameManager.container.touchEnabled=Net.getInstance().modeNum<=0},t)},t.getSector=function(t,e,i,n,r,o){void 0===t&&(t=100),void 0===e&&(e=0),void 0===i&&(i=360),void 0===n&&(n=16711680),void 0===r&&(r=1),o||(o=new egret.Shape);var s=0,a=0;o.graphics.clear(),o.graphics.beginFill(n,r),o.graphics.moveTo(s,a),i=Math.abs(i)>360?360:i;var h=Math.ceil(Math.abs(i)/45),c=i/h;c=c*Math.PI/180,e=e*Math.PI/180,o.graphics.lineTo(s+t*Math.cos(e),a+t*Math.sin(e));for(var l=1;h>=l;l++){e+=c;var u=e-c/2,d=s+t/Math.cos(c/2)*Math.cos(u),p=a+t/Math.cos(c/2)*Math.sin(u),g=s+t*Math.cos(e),f=a+t*Math.sin(e);o.graphics.curveTo(d,p,g,f)}return 360!=i&&o.graphics.lineTo(s,a),o.graphics.endFill(),o},t}();__reflect(MyTool.prototype,"MyTool");var MyWindow=function(){function t(){}return t.Alert=function(t,e,i){if(100==_get.debug)return void(document.body.style.background="#000000");var n=new AlertUI;n.show(t,e,i)},t.AlertRelogin=function(t){if(100==_get.debug)return void(document.body.style.background="#000000");var e=new AlertUI;e.show(t,function(){MyTool.refresh()}),GameManager.getInstance().stopTimer()},t.Confirm=function(t,e,i,n){void 0===i&&(i=["取消","确定"]);var r=new ConfirmUI;return r.show(t,e,i,n),r},t.ShowTips=function(t,e){void 0===e&&(e=0),e||(e=Math.max(1e3,150*t.length)),TipsUI.getInstance().show(t,e)},t.addBtnTips=function(t,e,i){function n(i){var n=i.stageX,s=i.stageY;t.stage.removeEventListener(egret.TouchEvent.TOUCH_END,r,t.thisObj||t),t.stage.once(egret.TouchEvent.TOUCH_END,r,t.thisObj||t),t.stage.once(egret.TouchEvent.TOUCH_CANCEL,r,t.thisObj||t),egret.clearTimeout(o),o=egret.setTimeout(function(){return Math.abs(GameManager.stageX-n)>20||Math.abs(GameManager.stageY-s)>20?(t.stage.removeEventListener(egret.TouchEvent.TOUCH_END,r,t.thisObj||t),void t.stage.removeEventListener(egret.TouchEvent.TOUCH_CANCEL,r,t.thisObj||t)):void("string"==typeof e?TouchTipsUI.getInstance().show(i,e):TouchTipsUI.getInstance().show(i,e.apply(t.thisObj||t)))},this,300)}function r(){t.stage.removeEventListener(egret.TouchEvent.TOUCH_END,r,t.thisObj||t),t.stage.removeEventListener(egret.TouchEvent.TOUCH_CANCEL,r,t.thisObj||t),TouchTipsUI.getInstance().stage&&(t.stopClickTimer=egret.getTimer()),egret.clearTimeout(o),TouchTipsUI.getInstance().hide()}var o;t.touchEnabled=!0,t.addEventListener(egret.TouchEvent.TOUCH_BEGIN,n,t.thisObj||t),i&&GameManager.stage.once(egret.Event.REMOVED_FROM_STAGE,function(){t.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,n,t.thisObj||t)},this)},t}();__reflect(MyWindow.prototype,"MyWindow");var Net=function(t){function e(){var e=t.call(this)||this;return e.msgIndex=0,e.modeNum=0,e.outPut=!0,e.actionRecord=[],e.modeNum=0,e}return __extends(e,t),e.getInstance=function(){return this.instance||(this.instance=new e),this.instance},e.send=function(t,i,n,r,o,s){void 0===r&&(r=!0),void 0===o&&(o=1),void 0===s&&(s=!1),e.getInstance().send(t,i,n,r,o,s)},e.addUser=function(t){t.gameid=UM.gameid},e.prototype.getVariables=function(t,e,i){var n=new egret.URLVariables("a=1"),r={};return r.head=t,e.gameid&&(r.msg_index=this.msgIndex,this.msgIndex++),r.msg=JSON.stringify(e),r.debug_client=Config.isDebug,1==i?r.version=Config.version:r.version=Config.user_version,_get.debug_server&&(r.debug_server=1),_get.game_version&&(r.game_version=_get.game_version),n.variables=r,n},e.prototype.pushRecord=function(t){for(this.actionRecord.push(t);this.actionRecord.length>10;)this.actionRecord.shift()},e.prototype.send=function(t,e,i,n,r,o){void 0===n&&(n=!0),void 0===r&&(r=1),void 0===o&&(o=!1);var s=new egret.URLLoader;if(s.dataFormat=egret.URLLoaderDataFormat.TEXT,s.isMode=n,s.fun=i,s.head=t,s.msg=e,s.isRepeat=o,1==r)var a=new egret.URLRequest(Config.host);else var a=new egret.URLRequest(Config.userHost);a.method=egret.URLRequestMethod.POST,a.data=this.getVariables(t,e,r),Config.isDebug&&this.outPut&&(console.log("send===>      "+t),console.log(JSON.stringify(e)+"   "+TM.now())),n&&(this.modeNum++,this.addLoading()),this.pushRecord("send:"+t+"#"+this.modeNum),s.load(a),s.addEventListener(egret.Event.COMPLETE,this.onComplete,this),s.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onError,this)
},e.prototype.onComplete=function(t){var e=t.currentTarget,i=e.isMode,n=e.fun,r=e.head,o=e.msg;i&&this.modeNum--,this.modeNum<=0&&this.removeLoading(),this.pushRecord("receive:"+r+"#"+this.modeNum),e.removeEventListener(egret.Event.COMPLETE,this.onComplete,this),e.removeEventListener(egret.IOErrorEvent.IO_ERROR,this.onError,this),Config.isDebug&&this.outPut&&(console.log("====receive>        "+r),console.log(t.target.data+"   "+TM.now()));try{var s=JSON.parse(t.target.data);Config.isDebug&&this.outPut&&console.log(s.msg)}catch(t){return void(Config.isDebug?MyWindow.Alert("通信数据异常"):MyWindow.Alert("通信数据异常",this.refresh,"重新登陆"))}if(s.error)switch(this.removeLoading(),s.error){case 1:_get.app?MyWindow.Alert("游戏已更新，请重新下载"):MyWindow.Alert("游戏已更新，请退出重进",this.refresh,"重新登陆"),GameManager.getInstance().stopTimer();break;case 2:MyWindow.Alert("该用户已在其它地方登录",this.refresh,"重新登陆"),GameManager.getInstance().stopTimer();break;case 3:MyWindow.Alert("通信出错",this.refresh,"重新登陆");break;case 4:MyWindow.Alert("用户数据写入失败",this.refresh,"重新登陆"),GameManager.getInstance().stopTimer();break;case 5:MyWindow.Alert("服务器正在维护中，请稍后再试",this.refresh),GameManager.getInstance().stopTimer();break;case 99:MyWindow.Alert(s.error_str,this.refresh),GameManager.getInstance().stopTimer();break;default:MyWindow.Alert("未知错误",this.refresh),GameManager.getInstance().stopTimer()}else{TM.init(s.server_time);var a={};a.sendData=o,a.msg=s.msg,n&&n(a),this.dispatchEventWith(r,!1,a)}},e.prototype.onError=function(t){var e=this,i=t.currentTarget;i.removeEventListener(egret.Event.COMPLETE,this.onComplete,this),i.removeEventListener(egret.IOErrorEvent.IO_ERROR,this.onError,this),i.isRepeat?MyWindow.Confirm("数据提交失败，与服务器失去连接！",function(t){1==t?e.send(i.head,i.msg,i.fun,i.isMode,1,!0):e.refresh()},["刷新","重试"]):(MyWindow.Alert("与服务器失去连接！",this.refresh),GameManager.getInstance().stopTimer()),this.pushRecord("error"+this.modeNum),this.removeLoading()},e.prototype.refresh=function(){location.reload()},e.prototype.addLoading=function(){MsgingUI.getInstance().show()},e.prototype.removeLoading=function(){MsgingUI.getInstance().hide()},e}(egret.EventDispatcher);__reflect(Net.prototype,"Net");var VScrollerGroup=function(t){function e(){var e=t.call(this)||this;return e.desTop=10,e.margin=10,e.marginLeft=0,e.marginBottom=0,e.pool=[],e.itemArr=[],e.heightObj={},e}return __extends(e,t),e.prototype.childrenCreated=function(){},e.prototype.initScroller=function(t){this.scroller=t,this.scroller.addEventListener(egret.Event.CHANGE,this.onScrollEvent,this),this.scroller.addEventListener(eui.UIEvent.CHANGE_END,this.onScrollEndEvent,this)},e.prototype.onScrollEvent=function(){this.dataArr&&(MyTool.resetScrollV(this.scroller),this.onScroll(this.scroller.viewport.scrollV),this.scrollTime=egret.getTimer())},e.prototype.onScrollEndEvent=function(){this.dataArr&&egret.getTimer()-this.scrollTime<500&&this.onScrollEvent()},e.prototype.getItem=function(){var t=this.pool.pop();return t||(t=new this.itemRenderer,t.x=this.marginLeft||0),this.addChild(t),t},e.prototype.feeItem=function(t){this.pool.push(t),MyTool.removeMC(t)},e.prototype.getFirstItem=function(t){for(var e=null,i=0;i<this.itemArr.length;i++)this.itemArr[i].y>=t&&(!e||this.itemArr[i].y<e.y)&&(e=this.itemArr[i]);return e},e.prototype.setData=function(t){this.clean(),this.heightObj={},this.dataArr=t,this.height=100},e.prototype.clean=function(){for(;this.itemArr.length>0;)this.feeItem(this.itemArr.pop())},e.prototype.addItem=function(t){this.dataArr.push(t)},e.prototype.scrollToLast=function(){this.dataArr.length>0&&this.scrollToItem(this.dataArr[this.dataArr.length-1])},e.prototype.scrollToItem=function(t){var e=this.dataArr.indexOf(t);if(-1!=e){if(0==e)return void this.scrollTo(0);for(var i=0,n=0;e>n;n++)this.heightObj[n]||(this.heightObj[n]=this.getHeight(this.dataArr[n])),i+=this.heightObj[n];this.scrollTo(i)}},e.prototype.scrollTo=function(t){this.scroller.stopAnimation(),this.scroller.viewport.scrollV=t,this.onScroll(t),this.scroller.viewport.scrollV+this.scroller.height>this.height&&(this.scroller.viewport.scrollV=Math.max(0,this.height-this.scroller.height)),t!=this.scroller.viewport.scrollV&&this.onScroll(this.scroller.viewport.scrollV)},e.prototype.onScroll=function(t){for(var e=this.scroller.height,i=!1,n=!1,r=this.desTop,o=0;t-50>r;){if(!this.heightObj[o]){if(!this.dataArr[o])break;this.heightObj[o]=this.getHeight(this.dataArr[o]),n=!0}r+=this.heightObj[o],o++}o--,0>o?o=0:r-=this.heightObj[o];for(var s=0;s<this.itemArr.length;s++)this.itemArr[s].y<r&&(this.feeItem(this.itemArr[s]),this.itemArr.splice(s,1),s--,i=!0);for(;t+e+50>r&&this.dataArr[o];){if(!this.isItemShow(this.dataArr[o])){var a=this.getItem();this.itemArr.push(a),this.addChild(a),a.data=this.dataArr[o],a.y=r,this.heightObj[o]||(a.validateNow(),this.heightObj[o]=a.height+this.margin,n=!0),i=!0}r+=this.heightObj[o],o++}for(var s=0;s<this.itemArr.length;s++)this.itemArr[s].y>r&&(this.feeItem(this.itemArr[s]),this.itemArr.splice(s,1),s--,i=!0);n&&this.resetHeight()},e.prototype.isItemShow=function(t){for(var e=0;e<this.itemArr.length;e++)if(this.itemArr[e].data==t)return!0;return!1},e.prototype.getHeight=function(t){var e=this.getItem();this.addChild(e),e.data=t,e.validateNow();var i=e.height+this.margin;return this.feeItem(e),i},e.prototype.resetHeight=function(){for(var t=this.dataArr.length,e=0,i=0;t>i&&this.heightObj[i];i++)e+=this.heightObj[i];this.height=e+e/i*(t-i)+this.desTop+this.marginBottom},e}(eui.Group);__reflect(VScrollerGroup.prototype,"VScrollerGroup");var WXDB=function(){function t(){}return t.updata=function(t,e,i){var n=window.wx;if(!n)return void(i&&i());var r=n.cloud.database();r.collection(t).doc(UM.dbid).update({data:e,success:function(t){i&&i()}})},t}();__reflect(WXDB.prototype,"WXDB");var BasePanel=function(t){function e(){var e=t.call(this)||this;return e.skinName="BasePanelSkin",e}return __extends(e,t),e.prototype.setTitle=function(t){this.nameText.text=t},e.prototype.setBottomHeight=function(t){this.bottomGroup.height=t},e}(game.BaseContainer);__reflect(BasePanel.prototype,"BasePanel");var AlertUI=function(t){function e(){var e=t.call(this)||this;return e.skinName="AlertSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){this.canBGClose=!1,t.prototype.childrenCreated.call(this),this.addBtnEvent(this.okBtn,this.onClick),MyTool.removeMC(this.closeBtn),MyTool.removeMC(this.cancelBtn)},e.prototype.show=function(e,i,n){this.textIn=e,this.fun=i,this.btnLabel=n,t.prototype.show.call(this)},e.prototype.onShow=function(){MyTool.setColorText(this.text,this.textIn),this.okBtn.label=this.btnLabel||"确认",this.text.numLines>1&&(this.text.textAlign="left");var t=GameManager.container.width,e=GameManager.container.height;this.x=(t-this.width)/2,this.y=(e-this.height)/2},e.prototype.onClick=function(){this.hide(),this.fun&&this.fun()},e}(game.BaseWindow);__reflect(AlertUI.prototype,"AlertUI");var BottomUI=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){this.addBtnEvent(this.closeBtn,this.backBtnClick)},e.prototype.setHide=function(t,e){this.hideFun=t,this.thisObj=e},e.prototype.backBtnClick=function(t){this.hideFun&&this.hideFun.apply(this.thisObj)},e}(game.BaseContainer);__reflect(BottomUI.prototype,"BottomUI");var CommonNumInput=function(t){function e(){var e=t.call(this)||this;return e._maxNum=999,e.minNum=1,e.stepNum=1,e.addStr="",e.skinName="CommonNumInputSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.addBtn.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onStart,this),this.addBtn.addEventListener(egret.TouchEvent.TOUCH_END,this.onEnd,this),this.addBtn.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onEnd,this),this.reduceBtn.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onEnd,this),this.reduceBtn.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onStart,this),this.reduceBtn.addEventListener(egret.TouchEvent.TOUCH_END,this.onEnd,this),this.input.addEventListener(egret.TextEvent.FOCUS_OUT,this.onOut,this),this.input.addEventListener(egret.TextEvent.FOCUS_IN,this.onIn,this),this.input.addEventListener(egret.TextEvent.CHANGE,this.onChange,this)},Object.defineProperty(e.prototype,"maxNum",{get:function(){return this._maxNum},set:function(t){this._maxNum=t,this.input.maxChars=String(t).length+1},enumerable:!0,configurable:!0}),e.prototype.onStart=function(t){t.preventDefault(),this.startTime=TM.now(),this.timer=egret.setInterval(this.onTimer,this,500),this.addNum=(t.currentTarget==this.addBtn?1:-1)*this.stepNum,MyTool.changeGray(this.addBtn,!1,!0),MyTool.changeGray(this.reduceBtn,!1,!0),this.onTimer(!0)},e.prototype.onTimer=function(t){this._nowNum+=this.addNum,this._nowNum>=this._maxNum?(this._nowNum=this._maxNum,this.addNum=0,MyTool.changeGray(this.addBtn,!0,!0)):this._nowNum<=this.minNum&&(this._nowNum=this.minNum,this.addNum=0,MyTool.changeGray(this.reduceBtn,!0,!0)),t||0==this.addNum||(this.timer=egret.setInterval(this.onTimer,this,30)),this.input.text=this._nowNum+this.addStr,this.renewCoin()},e.prototype.onEnd=function(t){egret.clearInterval(this.timer)},e.prototype.onIn=function(){this.input.text=parseInt(this.input.text)+""},e.prototype.onOut=function(){var t=parseInt(this.input.text);this.input.text=t+this.addStr,t%this.stepNum!=0&&(this.nowNum=Math.ceil(t/this.stepNum)*this.stepNum),MyTool.changeGray(this.addBtn,!1,!0),MyTool.changeGray(this.reduceBtn,!1,!0),t>=this._maxNum?(this.nowNum=this._maxNum,MyTool.changeGray(this.addBtn,!0,!0)):t<=this.minNum?(this.nowNum=this.minNum,MyTool.changeGray(this.reduceBtn,!0,!0)):this._nowNum=t,this.renewCoin()},e.prototype.onChange=function(){if(""==this.input.text)return this._nowNum=0,void this.renewCoin();var t=parseInt(this.input.text);t%this.stepNum!=0&&(this.nowNum=Math.ceil(t/this.stepNum)*this.stepNum),t>this._maxNum?this.nowNum=this._maxNum:this._nowNum=t,this.renewCoin()},e.prototype.renewCoin=function(){this.dispatchEventWith(e.RENEW)},Object.defineProperty(e.prototype,"nowNum",{get:function(){return this._nowNum<this.minNum&&(this.nowNum=this.minNum),this._nowNum},set:function(t){this._nowNum=t,this.input.text=t+this.addStr;var e=parseInt(this.input.text);MyTool.changeGray(this.addBtn,e>=this._maxNum,!0),MyTool.changeGray(this.reduceBtn,e<=this.minNum,!0)},enumerable:!0,configurable:!0}),e.prototype.init=function(t,e,i,n){this.minNum=t,this.maxNum=e,this.stepNum=i||1,this.input.maxChars=String(e).length+1,this.addBtn&&(MyTool.changeGray(this.addBtn,!1,!0),MyTool.changeGray(this.reduceBtn,!1,!0)),void 0!=n&&(this.nowNum=n,MyTool.changeGray(this.addBtn,this.nowNum>=this._maxNum,!0),MyTool.changeGray(this.reduceBtn,this.nowNum<=this.minNum,!0))},e.prototype.setEnabled=function(t){this.addBtn.visible=this.reduceBtn.visible=t,this.input.touchEnabled=t},e.RENEW="renew",e}(game.BaseItem);__reflect(CommonNumInput.prototype,"CommonNumInput");var ConfirmUI=function(t){function e(){var e=t.call(this)||this;return e.skinName="AlertSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.canBGClose=!1,this.addBtnEvent(this.okBtn,this.onClick),this.addBtnEvent(this.cancelBtn,this.onCancelClick),this.addBtnEvent(this.closeBtn,this.onCloseClick)},e.prototype.show=function(e,i,n,r){this.textIn=e,this.fun=i,this.btnWord=n,this.sp=r||{},t.prototype.show.call(this)},e.prototype.onShow=function(){MyTool.setColorText(this.text,this.textIn),this.text.validateNow(),this.text.numLines>1&&!this.sp.middle&&(this.text.textAlign="left"),this.btnWord&&(this.cancelBtn.label=this.btnWord[0],this.okBtn.label=this.btnWord[1]);var t=GameManager.container.width,e=GameManager.container.height;this.x=(t-this.width)/2,this.y=(e-this.height)/2,this.closeBtn.visible=!1},e.prototype.onClick=function(){this.hide(),this.fun&&this.fun(1)},e.prototype.onCancelClick=function(){this.hide(),this.fun&&this.fun(2)},e.prototype.onCloseClick=function(){this.hide(),this.fun&&this.fun(3)},e}(game.BaseWindow);__reflect(ConfirmUI.prototype,"ConfirmUI");var DebugUI=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.addBtnEvent(this.backBtn,this.hide);var e=window.wx;e&&this.addB("数据库",function(){e.cloud.database()})},e.prototype.addB=function(t,e){var i=new eui.Button;i.skinName="Btn1Skin",this.con.addChild(i),this.addBtnEvent(i,e)},e}(game.BaseUI);__reflect(DebugUI.prototype,"DebugUI");var DownList=function(t){function e(){var e=t.call(this)||this;return e.defaultStr="全部",e.skinName="DownListSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.addBtnEvent(this.btn,this.onOpen),this.scroller.viewport=this.list,this.list.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onSelect,this),this.list.itemRenderer=DownListItem,this.openHeight=this.height,this.isOpen=!1,this.renew()},e.prototype.onOpen=function(t){t.stopImmediatePropagation(),this.isOpen=!this.isOpen,this.isOpen&&this.stage.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickStage,this),this.renew()},e.prototype.onClickStage=function(){GameManager.stage.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickStage,this),this.isOpen=!1,this.renew()},e.prototype.renew=function(){this.isOpen&&!this.listCon.parent?this.addChild(this.listCon):!this.isOpen&&this.listCon.parent&&this.removeChild(this.listCon)},e.prototype.setData=function(t,e){void 0===e&&(e=0),this.dataArr=t,this.list.dataProvider=new eui.ArrayCollection(t),this.height=Math.min(this.openHeight,56*t.length-6+60-1),this.selectValue=e},Object.defineProperty(e.prototype,"selectValue",{get:function(){var t=this.list.selectedItem;return t?t.data:0},set:function(t){for(var e=this.dataArr,i=0;i<e.length;i++)if(e[i].data==t){this.list.selectedIndex=i;break}i>=e.length&&(t=0,this.list.selectedIndex=0),this.renewBtn(t)},enumerable:!0,configurable:!0}),e.prototype.renewBtn=function(t){for(var e=this.dataArr,i=0;i<e.length;i++)if(t==e[i].data)return this.titleText.text=e[i].label,void(this.img.source=e[i].icon);this.titleText.text=this.defaultStr},e.prototype.onSelect=function(){var t=this.list.selectedItem,i=t?t.data:0;this.dispatchEventWith(e.SELECT,!0,i),this.renewBtn(i)},e.SELECT="SELECT",e}(game.BaseContainer);__reflect(DownList.prototype,"DownList");var DownListItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="DownListItemSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.dataChanged=function(){this.data.icon?(this.img.source=this.data.icon,this.con.addChildAt(this.img,0)):MyTool.removeMC(this.img),this.text.text=this.data?""+this.data.label:"全部",this.data.label2&&(this.text.text+=this.data.label2)},e}(game.BaseItem);__reflect(DownListItem.prototype,"DownListItem");var LeftList=function(t){function e(){var e=t.call(this)||this;return e.defaultStr="全部",e.skinName="LeftListSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.addBtnEvent(this.btn,this.onOpen),this.scroller.viewport=this.list,this.list.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onSelect,this),this.list.itemRenderer=DownListItem,this.openHeight=this.height,this.isOpen=!1,this.renew()},e.prototype.onOpen=function(t){this.isOpen=!this.isOpen,this.isOpen&&egret.callLater(function(){this.stage.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickStage,this,!0)},this),this.renew()},e.prototype.onClickStage=function(t){t.stopImmediatePropagation(),GameManager.stage.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickStage,this,!0),this.isOpen=!1,this.renew()},e.prototype.renew=function(){this.isOpen&&!this.listCon.parent?this.addChild(this.listCon):!this.isOpen&&this.listCon.parent&&this.removeChild(this.listCon)},e.prototype.setData=function(t,e){void 0===e&&(e=0),this.dataArr=t,this.list.dataProvider=new eui.ArrayCollection(t),this.listCon.height=56*t.length,this.selectValue=e},Object.defineProperty(e.prototype,"selectValue",{get:function(){var t=this.list.selectedItem;return t?t.data:0},set:function(t){for(var e=this.dataArr,i=0;i<e.length;i++)if(e[i].data==t){this.list.selectedIndex=i;break}i>=e.length&&(t=0,this.list.selectedIndex=0),this.renewBtn(t)},enumerable:!0,configurable:!0}),e.prototype.renewBtn=function(t){for(var e=this.dataArr,i=0;i<e.length;i++)if(t==e[i].data)return void(this.img.source=e[i].icon)},e.prototype.onSelect=function(){var t=this.list.selectedItem,e=t?t.data:0;this.dispatchEventWith(DownList.SELECT,!0,e),this.renewBtn(e)},e.SELECT="SELECT",e}(game.BaseContainer);__reflect(LeftList.prototype,"LeftList");var TipsUI=function(t){function e(){var e=t.call(this)||this;return e.skinName="TipsUISkin",e}return __extends(e,t),e.getInstance=function(){var t=this.instancePool.pop();return t||(t=new e),t},e.prototype.show=function(t,i){for(var n=0;n<e.showTips.length;n++){var r=e.showTips[n];r.toY-=70,egret.Tween.removeTweens(r);var o=egret.Tween.get(r);o.to({y:r.toY},2*Math.abs(r.toY-r.y))}e.showTips.push(this),egret.clearTimeout(this.timer),GameManager.stage.addChild(this),MyTool.setColorText(this.text,t),this.text.numLines>1&&(this.text.textAlign="left"),this.visible=!1,this.timer=egret.setTimeout(this.onTimer,this,i+100*(e.showTips.length-1)),egret.setTimeout(function(){this.visible=!0},this,100*(e.showTips.length-1)),this.validateNow(),this.x=(GameManager.stage.stageWidth-this.width)/2,this.y=.2*GameManager.stage.stageHeight,this.toY=this.y},e.prototype.onTimer=function(){this.hide()},e.prototype.hide=function(){egret.clearTimeout(this.timer),MyTool.removeMC(this),PopUpManager.testShape(),e.instancePool.push(this);var t=e.showTips.indexOf(this);-1!=t&&e.showTips.splice(t,1)},e.instancePool=[],e.showTips=[],e}(game.BaseContainer);__reflect(TipsUI.prototype,"TipsUI");var TouchTipsUI=function(t){function e(){var e=t.call(this)||this;return e.skinName="TouchTipsSkin",e}return __extends(e,t),e.getInstance=function(){return this.instance||(this.instance=new e),this.instance},e.prototype.show=function(t,e){e&&(GameManager.container.addChild(this),MyTool.setHtml(this.text,e),this.validateNow(),this.y=t.stageY-this.height-100,this.y<0&&(this.y=t.stageY+120),this.x=t.stageX-this.width/2,this.x<10?this.x=10:this.x+this.width>630&&(this.x=630-this.width),GameManager.stage.once(egret.TouchEvent.TOUCH_CANCEL,this.hide,this))},e.prototype.hide=function(){MyTool.removeMC(this)},e}(game.BaseContainer);__reflect(TouchTipsUI.prototype,"TouchTipsUI");var UpList=function(t){function e(){var e=t.call(this)||this;return e.defaultStr="全部",e.skinName="UpListSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.addBtnEvent(this.btn,this.onOpen),this.scroller.viewport=this.list,this.list.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onSelect,this),this.list.itemRenderer=DownListItem,this.openHeight=this.height,this.isOpen=!1,this.renew()},e.prototype.onOpen=function(t){this.isOpen=!this.isOpen,this.isOpen&&egret.callLater(function(){this.stage.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickStage,this,!0)},this),this.renew()},e.prototype.onClickStage=function(t){t.stopImmediatePropagation(),GameManager.stage.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickStage,this,!0),this.isOpen=!1,this.renew()},e.prototype.renew=function(){this.isOpen&&!this.listCon.parent?this.addChild(this.listCon):!this.isOpen&&this.listCon.parent&&this.removeChild(this.listCon)},e.prototype.setData=function(t,e){void 0===e&&(e=0),this.dataArr=t,this.list.dataProvider=new eui.ArrayCollection(t),this.listCon.height=56*t.length,this.selectValue=e},Object.defineProperty(e.prototype,"selectValue",{get:function(){var t=this.list.selectedItem;return t?t.data:0},set:function(t){for(var e=this.dataArr,i=0;i<e.length;i++)if(e[i].data==t){this.list.selectedIndex=i;break}i>=e.length&&(t=0,this.list.selectedIndex=0),this.renewBtn(t)},enumerable:!0,configurable:!0}),e.prototype.renewBtn=function(t){for(var e=this.dataArr,i=0;i<e.length;i++)if(t==e[i].data)return void(this.titleText.text=e[i].label);this.titleText.text=this.defaultStr},e.prototype.onSelect=function(){var t=this.list.selectedItem,e=t?t.data:0;this.dispatchEventWith(DownList.SELECT,!0,e),this.renewBtn(e)},e.SELECT="SELECT",e}(game.BaseContainer);__reflect(UpList.prototype,"UpList");var UserInfoBtn=function(){function t(t,e,i,n){this.sourceBtn=t,this.parent=i,this.callFun=e,this.isNew=n}return t.prototype.initBtn=function(t,e,i,n,r){var o=this;if(console.log(1111),window.wx){console.log(222222);var s=screen.availWidth/640,a=screen.availHeight/GameManager.stage.stageHeight,h=s*i,c=a*n,l=s*t,u=s*e,d=window.wx.createUserInfoButton({type:"image",image:""+r,style:{left:h,top:c,width:l,height:u}});return d.onTap(function(t){o.callFun&&o.callFun(t)}),d}},Object.defineProperty(t.prototype,"visible",{set:function(t){if(console.log(t,this.isNew),t&&this.isNew&&!this.okBtn){var e=this.sourceBtn;isNaN(e.right)||(e.x=this.parent.width-e.right-e.width),isNaN(e.horizontalCenter)||(e.x=(this.parent.width-e.width)/2),isNaN(e.bottom)||(e.y=this.parent.height-e.bottom-e.height),this.okBtn=this.initBtn(e.width,e.height,e.x,e.y,this.isNew)}console.log(this.okBtn),this.okBtn&&(t?(this.sourceBtn.visible=!1,this.okBtn.show(),this.parent.once(egret.Event.REMOVED_FROM_STAGE,this.hide,this)):this.hide())},enumerable:!0,configurable:!0}),t.prototype.checkWindow=function(t){t.data!=this.parent&&this.parent.hide()},t.prototype.hide=function(){this.okBtn&&this.okBtn.hide(),this.sourceBtn.visible=!0},t}();__reflect(UserInfoBtn.prototype,"UserInfoBtn");var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.onProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var CarMC=function(t){function e(){var e=t.call(this)||this;return e.mc=new eui.Image("car_png"),e.addChild(e.mc),e.mc.x=e.mc.y=0,e.width=238,e.height=320,e}return __extends(e,t),e.createItem=function(){var t=this.pool.pop();return t||(t=new e),t},e.freeItem=function(t){t&&(t.remove(),this.pool.push(t))},e.prototype.remove=function(){MyTool.removeMC(this)},e.prototype.setCar=function(t){var e=GameData.getInstance().carData[t].artid,i=this.width,n=this.height,r=(e-1)%4,o=Math.floor((e-1)/4);this.mc.scrollRect=new egret.Rectangle(r*i,o*n,i,n)},e.pool=[],e}(eui.Group);__reflect(CarMC.prototype,"CarMC");var GameData=function(){function t(){this.isPlaying=!1,this.speed=0,this.maxSpeed=0,this.carid=0,this.addSpeed_=0,this.decSpeed_=0,this.addSpeedNum=0,this.decSpeedNum=0,this.lastAddSpeedTime=0,this.maxLen=0,this.startTime=0,this.baseSpeed=20,this.maxTime=3e4,this.redArr=[],this.level=1,this.countDown=0,this.passMeter=0,this.carData={1:{maxSpeed:100,addSpeed:5,decSpeed:15,buyType:0,buyValue:0,artid:1},2:{maxSpeed:110,addSpeed:6,decSpeed:15,buyType:1,buyValue:3,artid:2},3:{maxSpeed:120,addSpeed:7,decSpeed:20,buyType:2,buyValue:.1,artid:3},4:{maxSpeed:125,addSpeed:8,decSpeed:25,buyType:3,buyValue:1,artid:4},5:{maxSpeed:130,addSpeed:8,decSpeed:30,buyType:1,buyValue:10,artid:5},6:{maxSpeed:135,addSpeed:9,decSpeed:35,buyType:2,buyValue:.1,artid:6},7:{maxSpeed:140,addSpeed:9,decSpeed:30,buyType:3,buyValue:1,artid:7},8:{maxSpeed:145,addSpeed:10,decSpeed:35,buyType:2,buyValue:.1,artid:8},9:{maxSpeed:150,addSpeed:10,decSpeed:40,buyType:2,buyValue:.1,artid:9},10:{maxSpeed:155,addSpeed:11,decSpeed:35,buyType:1,buyValue:.1,artid:10},11:{maxSpeed:160,addSpeed:11,decSpeed:45,buyType:3,buyValue:1,artid:11},12:{maxSpeed:160,addSpeed:12,decSpeed:50,buyType:2,buyValue:.1,artid:12}}}return t.getInstance=function(){return this.instance||(this.instance=new t),this.instance},t.prototype.meterToPix=function(e){return e*t.MPV},t.prototype.pixToMeter=function(e){return e/t.MPV},t.prototype.getStarByLevel=function(t,e){var i=this.getMaxTime(t),n=e/i;return.7>n?3:.85>n?2:1},t.prototype.getMaxTime=function(t){return 1e3*Math.min(5*(t-1)+25,180)},t.prototype.onRunSpeed=function(){if(!this.countDown){if(this.lastAddSpeedTime){var t=egret.getTimer()-this.lastAddSpeedTime;this.passMeter+=1e3*this.speed/3600*(t/1e3)}this.lastAddSpeedTime=egret.getTimer()}},t.prototype.onGameStart=function(e){this.level=e,this.isPlaying=!0,this.speed=this.baseSpeed,this.startTime=egret.getTimer(),this.passMeter=0,this.countDown=4,this.lastAddSpeedTime=0,this.maxTime=this.getMaxTime(this.level);var i=1e5/3600*(this.maxTime/1e3);i=Math.floor(i*(.5+this.level/t.MaxLevel));var n=100+t.AlertMeter-100*this.level/t.MaxLevel;this.redArr=[];for(var r=0;i>r;){r+=n+Math.random()*n*.4+10;var o={start:r,speed:60+10*Math.floor(4*Math.random())+10*Math.floor(this.level/8)};this.redArr.push(o)}this.redArr.pop(),this.maxLen=i,console.log(this.maxLen,this.redArr)},t.prototype.addSpeed=function(t){t?(this.addSpeedNum+=1,this.addSpeedNum>30&&(this.addSpeedNum=30),this.speed+=this.addSpeed_*this.addSpeedNum*.003,this.speed>this.maxSpeed&&(this.speed=this.maxSpeed)):this.addSpeedNum=0},t.prototype.decSpeed=function(t){t?(this.decSpeedNum+=1,this.decSpeedNum>30&&(this.decSpeedNum=30),this.speed-=this.decSpeed_*this.decSpeedNum*.003,this.speed<0&&(this.speed=0)):this.decSpeedNum=0},t.prototype.setCar=function(t){this.carid=t;var e=this.carData[t];this.maxSpeed=e.maxSpeed,this.addSpeed_=e.addSpeed,this.decSpeed_=e.decSpeed},t.speedRate=.25,t.Frame=60,t.MPV=54,t.MaxLevel=30,t.MaxCar=12,t.AlertMeter=100,t.FailDecTime=1e4,t}();__reflect(GameData.prototype,"GameData");var GameUI=function(t){function e(){var e=t.call(this)||this;return e.posRateMC=new egret.Shape,e.cdRateMC=new egret.Shape,e.alarmMC=new egret.Shape,e.timer=new MyTimer(1e3/GameData.Frame),e.alarm=0,e.lastDrawAlarm=0,e.treeArr1=[],e.treeArr2=[],e.treePool=[],e.carArr=[],e.road={1:{pos:-75},2:{pos:-230},3:{pos:230}},e.lastCreateCarTime=0,e.gameState=0,e.carIndex=5,e.touchID={},e.skinName="GameUISkin",e}return __extends(e,t),e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.show=function(){t.prototype.show.call(this)},e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.alarmMC.x=this.posRateMC.x=this.cdRateMC.x=152,this.alarmMC.y=this.posRateMC.y=this.cdRateMC.y=154,this.meterGroup.addChildAt(this.alarmMC,1),this.meterGroup.addChildAt(this.posRateMC,0),this.meterGroup.addChildAt(this.cdRateMC,0),this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this),this.addEventListener(egret.TouchEvent.TOUCH_CANCEL,this.onTouchEnd,this),this.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchEnd,this),this.addBtnEvent(this.rankBtn,this.onRank),this.addBtnEvent(this.levelBtn,this.onLevel),this.addBtnEvent(this.skinBtn,this.onSkin),this.addBtnEvent(this.settingBtn,this.onSetting),this.addBtnEvent(this.exitBtn,this.reset),this.addBtnEvent(this.debugBtn,this.onDebug),this.debugBtn.visible=!1,this.addBtnEvent(this.startBtn,this.onStart),this.timer.addEventListener(egret.TimerEvent.TIMER,this.onE,this),this.carMC=new CarMC,this.carMC.setCar(1),this.addChildAt(this.carMC,this.carIndex),this.carMC.scaleX=this.carMC.scaleY=.7,this.carMC.horizontalCenter=75,this.carMC.bottom=350,this.failMC.visible=!1,this.infoBtn=new UserInfoBtn(this.startBtn,function(t){e.renewInfo(t)},this,Config.localResRoot+"wx_btn_info.png")},e.prototype.renewInfo=function(t){var e=this,i=window.wx;if(i){if(t)return this.infoBtn.visible=!1,UM.renewInfo(t.userInfo),void(this.bottomGroup.visible=!0);this.bottomGroup.visible=!1,this.startBtn.visible=!1,i.getSetting({success:function(t){console.log(t.authSetting),t.authSetting["scope.userInfo"]?i.getUserInfo({success:function(t){var i=t.userInfo;UM.renewInfo(t.userInfo),UM.head=i.avatarUrl,UM.gender=i.gender||1,e.bottomGroup.visible=!0,e.infoBtn.visible=!1,e.startBtn.visible=!0}}):e.infoBtn.visible=!0}})}},e.prototype.onDebug=function(){DebugUI.getInstance().show()},e.prototype.showFailMC=function(){var t=this;this.failMC.visible=!0,this.failMC.alpha=0,egret.Tween.removeTweens(this.failMC),egret.Tween.get(this.failMC).to({alpha:.5},250).to({alpha:0},250).call(function(){t.failMC.visible=!1})},e.prototype.onTouchBegin=function(t){this.touchID[t.touchPointID]={x:t.stageX,y:t.stageY}},e.prototype.onTouchMove=function(t){this.touchID[t.touchPointID]={x:t.stageX,y:t.stageY}},e.prototype.onTouchEnd=function(t){delete this.touchID[t.touchPointID]},e.prototype.onRank=function(){RankUI.getInstance().show()},e.prototype.onLevel=function(){LevelUI.getInstance().show()},e.prototype.onSkin=function(){SkinUI.getInstance().show()},e.prototype.onSetting=function(){SoundManager.getInstance().soundPlaying=!SoundManager.getInstance().soundPlaying,SoundManager.getInstance().bgPlaying=!SoundManager.getInstance().bgPlaying,this.settingBtn.source=SoundManager.getInstance().bgPlaying?"sound_on_btn_png":"sound_off_btn_png"},e.prototype.onStart=function(){this.startLevel(CarManager.getInstance().maxLevel+1)},e.prototype.renewCar=function(){this.carMC.setCar(CarManager.getInstance().skinid)},e.prototype.startLevel=function(t){GameData.getInstance().setCar(CarManager.getInstance().skinid),GameData.getInstance().onGameStart(t),this.touchID={},this.currentState="game",this.alarm=0,this.limitGroup.visible=!1,this.posRateMC.visible=!1,this.cdRateMC.visible=!1,this.errorMC.visible=!1,this.alarmMC.visible=!1,this.gameLevelText.text="LV."+t},e.prototype.onShow=function(){SoundManager.getInstance().playSound("road"),this.renewInfo(),this.timer.start(),this.reset()},e.prototype.reset=function(){this.currentState="main",this.gameState=0,this.line1.bottom=0,this.line2.bottom=0,this.bg.bottom=0,this.errorMC.visible=!1,this.levelText.text="第 "+(CarManager.getInstance().maxLevel+1)+" 关",GameData.getInstance().isPlaying=!1;for(var t in this.road){var e=this.road[t].car;e&&(CarMC.freeItem(e),this.road[t].car=null)}},e.prototype.onE=function(){var t=GameData.getInstance();if(t.isPlaying){if(t.countDown){var e=3-Math.floor((egret.getTimer()-t.startTime)/1e3);0>=e?(SoundManager.getInstance().playEffect("count_down4"),t.countDown=0,t.startTime=egret.getTimer(),this.readyText.text="",this.posRateMC.visible=!0,this.cdRateMC.visible=!0,this.resetRed()):t.countDown!=e&&(SoundManager.getInstance().playEffect("count_down"),t.countDown=e,this.readyText.text=""+e,egret.Tween.removeTweens(this.readyText),this.readyText.scaleX=this.readyText.scaleY=0,egret.Tween.get(this.readyText).to({scaleX:1.2,scaleY:1.2},250).to({scaleX:1,scaleY:1},250))}var i=!1,n=!0;for(var r in this.touchID)i=!0,n=!1;t.addSpeed(i),t.decSpeed(n),t.speed<t.baseSpeed&&(t.speed=t.baseSpeed);var o=t.speed;this.onMoveBG(o),t.onRunSpeed();var s=Math.min(1,t.passMeter/t.maxLen);this.posRateMC.visible&&MyTool.getSector(159,180,180*s,153,1,this.posRateMC);var a=t.maxTime+t.startTime-egret.getTimer();if(0>a)return t.isPlaying=!1,this.gameState=2,void ResultFailUI.getInstance().show();if(s>=1)return t.isPlaying=!1,this.gameState=1,void ResultUI.getInstance().show();if(this.cdRateMC.visible){var h=(egret.getTimer()-t.startTime)/t.maxTime;MyTool.getSector(166,180,180*h,16569680,1,this.cdRateMC)}this.speedText.text=Math.floor(t.speed)+"";var c=t.speed/t.maxSpeed*3;if(1>c&&(c=0),this.needle.rotation=180+t.speed/160*180+(Math.random()-.5)*c,this.onOtherCarMove(),!t.countDown&&this.errorMC.visible){var l=t.redArr[0],u=l.start-t.passMeter;if(this.errorMC.bottom=this.carMC.bottom+this.carMC.height*this.carMC.scaleY+t.meterToPix(u),0==this.alarm&&u<=GameData.AlertMeter&&u>GameData.AlertMeter/2&&(this.alarm=1,this.lastDrawAlarm=0,SoundManager.getInstance().playEffect("limit_before",function(){SoundManager.getInstance().playEffect("limit"+l.speed)
})),this.limitGroup.visible=1==this.alarm,this.alarmMC.visible=1==this.alarm,this.alarmMC.visible){var h=l.speed/160;if(l.speed<=t.speed)var d=1;else var d=2;this.lastDrawAlarm!=d&&(this.lastDrawAlarm=d,1==d?MyTool.getSector(100,180,180*h,16711680,1,this.alarmMC):MyTool.getSector(100,180,180*h,65280,1,this.alarmMC))}0>=u&&this.alarm<2?(this.alarm=2,t.speed>l.speed&&(SoundManager.getInstance().playEffect("photo"),t.startTime-=GameData.FailDecTime,this.showFailMC(),t.redArr.shift(),this.resetRed(),this.limitGroup.visible=!1,this.alarmMC.visible=!1)):2==this.alarm?(this.alarm=3,SoundManager.getInstance().playEffect("pass")):3==this.alarm&&this.errorMC.bottom<-this.errorMC.height&&(t.redArr.shift(),this.resetRed()),this.limitGroup.visible&&(this.rateMC2.width=200*Math.min((GameData.AlertMeter-u)/GameData.AlertMeter,1))}}else if(this.gameState){this.errorMC.visible=!1;var p=2==this.gameState?0:t.baseSpeed;t.speed>p&&t.decSpeed(!0),this.speedText.text=Math.floor(t.speed)+"",this.onMoveBG(t.speed),this.onOtherCarMove()}else this.onMoveBG(t.baseSpeed)},e.prototype.resetRed=function(){this.alarm=0;var t=GameData.getInstance(),e=t.redArr[0];return e?void(this.errorMC.visible=!0):void(this.errorMC.visible=!1)},e.prototype.onOtherCarMove=function(){var t=[];for(var e in this.road){var i=this.road[e].car;if(i){var n=i.speed-GameData.getInstance().speed;n*=GameData.speedRate,i.bottom+=n,(i.bottom<-300||i.bottom>GameManager.stage.stageHeight+200)&&(CarMC.freeItem(i),this.road[e].car=null)}else t.push(this.road[e])}if(!this.gameState&&t.length>0&&egret.getTimer()-this.lastCreateCarTime>500&&Math.random()<.1){this.lastCreateCarTime=egret.getTimer();var r=ArrayUtil.randomOne(t),i=CarMC.createItem();i.scaleX=i.scaleY=.7,i.setCar(Math.ceil(12*Math.random())),r.car=i,i.horizontalCenter=r.pos,i.speed=Math.floor(50+70*Math.random()),this.addChildAt(i,this.carIndex),r.pos<0?(i.scaleY*=-1,i.speed*=-.6,i.bottom=GameManager.stage.stageHeight+100):i.speed<GameData.getInstance().speed?i.bottom=GameManager.stage.stageHeight+100:i.bottom=-150}},e.prototype.onMoveBG=function(t){t*=GameData.speedRate;var e=160;this.line1.bottom-=t,this.line2.bottom-=t,this.bg.bottom-=t,this.line1.bottom<-e&&(this.line1.bottom+=e),this.line2.bottom<-e&&(this.line2.bottom+=e),this.bg.bottom<-100&&(this.bg.bottom+=100);for(var i=0;i<this.treeArr1.length;i++)this.treeArr1[i].bottom-=t,this.treeArr1[i].bottom<-200&&(this.freeTree(this.treeArr1[i]),this.treeArr1.splice(i,1),i--);for(var i=0;i<this.treeArr2.length;i++)this.treeArr2[i].bottom-=t,this.treeArr2[i].bottom<-200&&(this.freeTree(this.treeArr2[i]),this.treeArr2.splice(i,1),i--);for(var n=150;!this.treeArr1[0]||this.treeArr1[this.treeArr1.length-1].bottom<GameManager.stage.stageHeight-n;){var r=this.getTree();this.treeArr1[0]?r.bottom=this.treeArr1[this.treeArr1.length-1].bottom+n+20*Math.random():r.bottom=0,this.treeArr1.push(r),this.treeGroup.addChildAt(r,0),r.right=590}for(;!this.treeArr2[0]||this.treeArr2[this.treeArr2.length-1].bottom<GameManager.stage.stageHeight-n;){var r=this.getTree();this.treeArr2[0]?r.bottom=this.treeArr2[this.treeArr2.length-1].bottom+n+20*Math.random():r.bottom=0,this.treeArr2.push(r),this.treeGroup.addChildAt(r,0),r.right=-30}},e.prototype.getTree=function(){var t=this.treePool.pop();return t||(t=new eui.Image,t.source="tree_"+Math.ceil(2+6*Math.random())+"_png"),t},e.prototype.freeTree=function(t){MyTool.removeMC(t),this.treePool.push(t)},e}(game.BaseUI);__reflect(GameUI.prototype,"GameUI");var LevelItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="LevelItemSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){this.addBtnEvent(this,this.onClick)},e.prototype.onClick=function(){"current"==this.currentState&&(LevelUI.getInstance().hide(),GameUI.getInstance().startLevel(this.data))},e.prototype.dataChanged=function(){this.indexText.text=this.data;var t=CarManager.getInstance().getLevelStar(this.data);if(t||this.data==CarManager.getInstance().maxLevel+1){this.currentState="current";for(var e=0;3>e;e++)this["s"+e].source=t>e?"chapter_star4_png":"chapter_star3_png"}else this.currentState="lock"},e}(game.BaseItem);__reflect(LevelItem.prototype,"LevelItem");var LevelUI=function(t){function e(){var e=t.call(this)||this;return e.skinName="LevelUISkin",e}return __extends(e,t),e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.childrenCreated=function(){this.addBtnEvent(this.closeBtn,this.hide),this.scroller.viewport=this.list,this.list.itemRenderer=LevelItem},e.prototype.show=function(){t.prototype.show.call(this)},e.prototype.onShow=function(){for(var t=[],e=0;e<GameData.MaxLevel;e++)t.push(e+1);this.list.dataProvider=new eui.ArrayCollection(t)},e}(game.BaseWindow);__reflect(LevelUI.prototype,"LevelUI");var RankUI=function(t){function e(){var e=t.call(this)||this;return e.isdisplay=!1,e.skinName="RankUISkin",e}return __extends(e,t),e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.addBtnEvent(this.closeBtn,this.hide),this.touchEnabled=!1},e.prototype.onShow=function(){window.wx&&this.showBitmapList()},e.prototype.poseData=function(){var t={me:UM.gameid,command:"open",x:this.bitmap.x+(GameManager.uiWidth-this.width)/2,y:this.bitmap.y+(GameManager.uiHeight-this.height)/2,me_value:CarManager.getInstance().getAllStar()+",0",root:"openDataContext/"},e=window.platform;e.openDataContext.postMessage(t)},e.prototype.showBitmapList=function(){if(window.wx&&window.wx.getOpenDataContext){this.remove();var t=window.platform;this.isdisplay||(this.bitmap=t.openDataContext.createDisplayObject(null,this.stage.stageWidth,this.stage.stageHeight),this.bitmap.x=20,this.bitmap.y=110,this.addChild(this.bitmap),this.bitmap.touchEnabled=!1,this.isdisplay=!0,this.poseData())}},e.prototype.remove=function(){var t=window.platform;this.isdisplay&&(this.isdisplay=!1,this.bitmap.parent&&this.bitmap.parent.removeChild(this.bitmap),t.openDataContext&&t.openDataContext.postMessage({command:"close"}))},e.prototype.hide=function(){this.remove(),t.prototype.hide.call(this)},e}(game.BaseWindow);__reflect(RankUI.prototype,"RankUI");var ResultFailUI=function(t){function e(){var e=t.call(this)||this;return e.skinName="ResultFailUISkin",e}return __extends(e,t),e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.childrenCreated=function(){this.addBtnEvent(this.backBtn,this.hide),this.addBtnEvent(this.retryBtn,this.onRetry)},e.prototype.onRetry=function(){this.hide(),GameUI.getInstance().startLevel(GameData.getInstance().level)},e.prototype.hide=function(){t.prototype.hide.call(this),GameUI.getInstance().reset()},e.prototype.show=function(){t.prototype.show.call(this)},e.prototype.onShow=function(){SoundManager.getInstance().playEffect("die");var t=GameData.getInstance(),e=Math.min(1,t.passMeter/t.maxLen);if(this.rateText.text=Math.floor(100*e)+"%",CarManager.getInstance().maxLevel<t.level){var i=SharedObjectManager.getInstance().getMyValue("chapter"+t.level)||0;i++,SharedObjectManager.getInstance().setMyValue("chapter"+t.level,i),this.timesText.text="已尝试"+i+"次"}else this.timesText.text=""},e}(game.BaseWindow);__reflect(ResultFailUI.prototype,"ResultFailUI");var ResultUI=function(t){function e(){var e=t.call(this)||this;return e.skinName="ResultUISkin",e}return __extends(e,t),e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.childrenCreated=function(){this.addBtnEvent(this.backBtn,this.hide),this.addBtnEvent(this.nextBtn,this.onNext),this.addBtnEvent(this.shartBtn,this.onShare),this.shartBtn.visible=!1},e.prototype.onShare=function(){},e.prototype.onNext=function(){this.hide(),GameUI.getInstance().onStart()},e.prototype.hide=function(){t.prototype.hide.call(this),GameUI.getInstance().reset()},e.prototype.show=function(){var e=this;this.useTime=egret.getTimer()-GameData.getInstance().startTime,CarManager.getInstance().sendSuccess(this.useTime,function(){t.prototype.show.call(e)})},e.prototype.onShow=function(){SoundManager.getInstance().playEffect("win");for(var t=GameData.getInstance(),e=t.getStarByLevel(t.level,this.useTime),i=0;3>i;i++)this["s"+i].source=e>i?"chapter_star2_png":"chapter_star1_png";this.nextText.visible=t.level==CarManager.getInstance().maxLevel;var n=this.useTime,r=Math.floor(n%1e3/10);n=Math.floor(n/1e3),this.timeText.text=DateUtil.getStringBySecond(n).substr(-5)+"."+("00"+r).substr(-2)},e}(game.BaseWindow);__reflect(ResultUI.prototype,"ResultUI");var SkinItem=function(t){function e(){var e=t.call(this)||this;return e.carMC=new CarMC,e.skinName="SkinItemSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){this.addBtnEvent(this,this.onClick),this.addBtnEvent(this.btn,this.onBuy),this.addChildAt(this.carMC,1),this.carMC.horizontalCenter=0,this.carMC.y=8,this.carMC.scaleX=this.carMC.scaleY=.5},e.prototype.onBuy=function(t){if(t.stopImmediatePropagation(),"解锁"==this.btn.label)return void CarManager.getInstance().buySkin(this.data,function(){});var e=GameData.getInstance().carData[this.data];switch(e.buyType){case 0:break;case 1:SkinUI.getInstance().hide(),GameUI.getInstance().onStart();break;case 2:break;case 3:console.log(UM.gameid),ShareTool.share("集赞换新车，就差你了",Config.localResRoot+"share_img_1.jpg",{type:1,from:UM.gameid,skinid:this.data});break;case 4:}},e.prototype.onClick=function(){SkinUI.getInstance().currentSkin!=this.data&&CarManager.getInstance().isHaveSkin(this.data)&&(SkinUI.getInstance().currentSkin=this.data,EM.dispatch(GameEvent.client.SKIN_CHANGE),SoundManager.getInstance().playEffect("switch"))},e.prototype.onTimer=function(){"lock"==this.currentState&&2==GameData.getInstance().carData[this.data].buyType&&this.dataChanged()},e.prototype.dataChanged=function(){var t=CarManager.getInstance().skins.length;if(this.data>t+1)return this.currentState="lock2",this.carMC.visible=!1,void(this.cacheAsBitmap=!1);var e=GameData.getInstance().carData[this.data];if(this.carMC.visible=!0,this.carMC.setCar(this.data),CarManager.getInstance().isHaveSkin(this.data)){var i=10077693;this.setUsing(SkinUI.getInstance().currentSkin==this.data),this.currentState="normal",this.setHtml(this.desText,this.createHtml("时速：",i)+e.maxSpeed+"KM\n"+this.createHtml("加速：",i)+e.addSpeed+"KM\n"+this.createHtml("制动：",i)+e.decSpeed+"KM")}else{this.cacheAsBitmap=!1,this.currentState="lock";var n=CarManager.getInstance().getSkinValue(this.data),r=e.buyValue;switch(this.btn.visible=!0,e.buyType){case 0:break;case 1:this.rateText.text="完成第"+r+"关",this.btn.label="前往";break;case 2:this.rateText.text=r+"小时后获得",this.btn.visible=!1;break;case 3:this.rateText.text="邀请"+r+"个新用户",this.btn.label="邀请";break;case 4:this.rateText.text="观看广告"+r+"次",this.btn.label="观看"}this.barMC.width=240*Math.min(n/r,1),n>=r&&(this.btn.label="解锁",this.btn.visible=!0)}},e.prototype.setUsing=function(t){if(!t)return this.carMC.filters=[],void(this.cacheAsBitmap=!1);var e=3394815,i=.8,n=80,r=80,o=2,s=3,a=!1,h=!1,c=new egret.GlowFilter(e,i,n,r,o,s,a,h);this.carMC.filters=[c]},e}(game.BaseItem);__reflect(SkinItem.prototype,"SkinItem");var SkinUI=function(t){function e(){var e=t.call(this)||this;return e.skinName="SkinUISkin",e}return __extends(e,t),e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.childrenCreated=function(){this.addBtnEvent(this.closeBtn,this.hide),this.scroller.viewport=this.list,this.list.itemRenderer=SkinItem},e.prototype.show=function(){t.prototype.show.call(this)},e.prototype.onShow=function(){this.currentSkin=CarManager.getInstance().skinid,this.addPanelOpenEvent(GameEvent.client.SKIN_CHANGE,this.renewList);for(var t=[],e=0;e<GameData.MaxCar;e++)t.push(e+1);this.list.dataProvider=new eui.ArrayCollection(t)},e.prototype.renewList=function(){MyTool.renewList(this.list)},e.prototype.onTimer=function(){MyTool.runListFun(this.list,"onTimer")},e.prototype.hide=function(){t.prototype.hide.call(this),this.currentSkin!=CarManager.getInstance().skinid&&CarManager.getInstance().setCarSkin(this.currentSkin,function(){})},e}(game.BaseWindow);__reflect(SkinUI.prototype,"SkinUI");var EventManager=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.getInstance=function(){return e._instance||(e._instance=new e),e._instance},e.prototype.dispatch=function(t,i){e.getInstance().dispatchEventWith(t,!1,i)},e.prototype.addEvent=function(t,i,n){e.getInstance().addEventListener(t,i,n)},e.prototype.removeEvent=function(t,i,n){e.getInstance().removeEventListener(t,i,n)},e}(egret.EventDispatcher);__reflect(EventManager.prototype,"EventManager");var GameManager=function(){function t(){this.timeID=new egret.Timer(1e3),this.timeID.addEventListener(egret.TimerEvent.TIMER,this.timerun,this),this.timeID.start()}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},Object.defineProperty(t,"uiHeight",{get:function(){return this.stage.stageHeight},enumerable:!0,configurable:!0}),Object.defineProperty(t,"uiWidth",{get:function(){return this.stage.stageWidth},enumerable:!0,configurable:!0}),t.prototype.isWebGL=function(){return"webgl"==egret.Capabilities.renderMode},t.prototype.init=function(){t.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this),t.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this)},t.prototype.stopTimer=function(){this.timeID.stop()},t.prototype.onTouchMove=function(e){t.stageX=e.stageX,t.stageY=e.stageY},t.prototype.onTouchBegin=function(e){this.lastTouchMC=e.target,t.stageX=e.stageX,t.stageY=e.stageY,this.lastTouchTime=egret.getTimer()},t.prototype.timerun=function(){var t=TM.now();return this.lastTime?(DateUtil.isSameDay(this.lastTime,t)||EM.dispatch(GameEvent.client.pass_day),EM.dispatch(GameEvent.client.timer),void(this.lastTime=t)):void(this.lastTime=t)},t.prototype.getZeroCD=function(){var t=DateUtil.timeToChineseDate(TM.now());return t.setMinutes(0),t.setSeconds(0),t.setMilliseconds(0),t.setHours(24),Math.floor(t.getTime()/1e3)-TM.now()},t}();__reflect(GameManager.prototype,"GameManager");var App=function(){function t(){}return Object.defineProperty(t,"isMobile",{get:function(){return egret.MainContext.deviceType==egret.MainContext.DEVICE_MOBILE},enumerable:!0,configurable:!0}),Object.defineProperty(t,"isAndroid",{get:function(){var t=navigator.userAgent.toLowerCase();return-1!=t.indexOf("android")},enumerable:!0,configurable:!0}),Object.defineProperty(t,"isIOS",{get:function(){var t=navigator.userAgent.toLowerCase();return/ip(ad|hone|od)/.test(t)},enumerable:!0,configurable:!0}),t.touchEvent=egret.TouchEvent.TOUCH_TAP,t}();if(__reflect(App.prototype,"App"),window.wx){var wx=window.wx;wx.onHide(function(t){GameManager.stage&&(SoundManager.getInstance().stopBgSound(),GameManager.stage.dispatchEventWith(egret.Event.DEACTIVATE),console.log("hide"))}),wx.onShow(function(t){GameManager.stage&&(SoundManager.getInstance().playSound("road"),GameManager.stage.dispatchEventWith(egret.Event.ACTIVATE),console.log("show"))})}var SharedObjectManager=function(){function t(){}return t.getInstance=function(){return t._instance||(t._instance=new t),t._instance},t.prototype.getUserSign=function(){return UM.gameid},t.prototype.setMyValue=function(t,e){t=this.getUserSign()+"_"+t,this.setValue(t,e)},t.prototype.getMyValue=function(t){return t=this.getUserSign()+"_"+t,this.getValue(t)},t.prototype.removeMyValue=function(t){t=this.getUserSign()+"_"+t,delete localStorage[t]},t.prototype.setValue=function(t,e){var i={};i.data=e,i=JSON.stringify(i),localStorage[t]=i},t.prototype.getValue=function(t){var e=localStorage[t];if(!e)return null;var i=JSON.parse(e);return i.data},t}();__reflect(SharedObjectManager.prototype,"SharedObjectManager");var SoundManager=function(){function t(){this._soundPlaying=!1,this._bgPlaying=!1,this._openShake=!0,this._isPlayMovie=!0,this._isMessage=!0,this.isLoad=!1,this.pkKey=[],this.effectKey=[],this.init()}return t.getInstance=function(){return this.instance||(this.instance=new t),this.instance},t.prototype.init=function(){this._soundPlaying=!0,this._bgPlaying=!0;var t=SharedObjectManager.getInstance();void 0!=t.getValue("sound")&&(this._soundPlaying=t.getValue("sound")),void 0!=t.getValue("bgsound")&&(this._bgPlaying=t.getValue("bgsound")),void 0!=t.getValue("openShake")&&(this._openShake=t.getValue("openShake")),void 0!=t.getValue("playMovie")&&(this._isPlayMovie=t.getValue("playMovie")),void 0!=t.getValue("showMessage")&&(this._isMessage=t.getValue("showMessage")),this.isLoad=this._soundPlaying},Object.defineProperty(t.prototype,"soundPlaying",{get:function(){return this._soundPlaying},set:function(t){this._soundPlaying!=t&&SharedObjectManager.getInstance().setValue("sound",t),this._soundPlaying=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bgPlaying",{get:function(){return this._bgPlaying},set:function(t){this._bgPlaying!=t&&SharedObjectManager.getInstance().setValue("bgsound",t),this._bgPlaying=t,t?this.playSound("road"):this.stopBgSound()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"openShake",{get:function(){return this._openShake},set:function(t){this._openShake!=t&&SharedObjectManager.getInstance().setValue("openShake",t),this._openShake=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isPlayMovie",{get:function(){return this._isPlayMovie},set:function(t){this._isPlayMovie!=t&&SharedObjectManager.getInstance().setValue("playMovie",t),this._isPlayMovie=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isMessage",{get:function(){return this._isMessage},set:function(t){this._isMessage!=t&&SharedObjectManager.getInstance().setValue("showMessage",t),this._isMessage=t},enumerable:!0,configurable:!0}),t.prototype.addBtnClickEffect=function(t){t.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.playBtn()},this)},t.prototype.playBtn=function(){this.playEffect("btn")},t.prototype.stopBgSound=function(){this.lastBGKey=this.bgKey,this.bgKey=null;try{egret.clearTimeout(this.playTime),this.currentChannel&&(egret.Tween.removeTweens(this.currentChannel),this.currentChannel.stop()),this.onSoundComplete()}catch(t){}},t.prototype.playEffect=function(t,e,i){if(this.soundPlaying){console.log("call:",t);var n="resource/sound/"+t+".mp3",r=new egret.URLLoader;r.dataFormat=egret.URLLoaderDataFormat.SOUND,r.once(egret.Event.COMPLETE,function(){var n=r.data,o=n.play(0,1);console.log(t),e&&o.once(egret.Event.SOUND_COMPLETE,e,i)},this),r.load(new egret.URLRequest(n))}},t.prototype.resumeSound=function(){this.lastBGKey&&this.playSound(this.lastBGKey)},t.prototype.playSound=function(t,e){if(void 0===e&&(e=9999),this.bgPlaying&&this.bgKey!=t){this.bgKey=t;var i="resource/sound/"+t+".mp3";if(this.currentKey!=i){this.currentKey=i;try{this.tempLoop=e;var n=new egret.URLLoader;n.dataFormat=egret.URLLoaderDataFormat.SOUND,n.addEventListener(egret.Event.COMPLETE,this.onLoadComplete,this),n.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onLoadError,this),n.load(new egret.URLRequest(i))}catch(r){}}}},t.prototype.onLoadComplete=function(t){function e(){var t=i.data,e=t.play(0,n.tempLoop);n.currentChannel=e,e.addEventListener(egret.Event.SOUND_COMPLETE,n.onSoundComplete,n)}egret.clearTimeout(this.playTime);var i=t.target,n=this;try{if(this.onLoadError(t),this.currentKey&&i.data.url!=this.currentKey||!this._bgPlaying)return;if(this.currentChannel){if(n.currentChannel.stop(),n.currentChannel=null,!n._bgPlaying)return}else e()}catch(r){}},t.prototype.onSoundComplete=function(t){this.currentChannel=null,this.currentKey=null},t.prototype.onLoadError=function(t){var e=t.target;e.removeEventListener(egret.Event.COMPLETE,this.onLoadComplete,this),e.removeEventListener(egret.IOErrorEvent.IO_ERROR,this.onLoadError,this)},t}();__reflect(SoundManager.prototype,"SoundManager");var TimeManager=function(){function t(){this.timeDiff=0}return t.getInstance=function(){return t._instance||(t._instance=new t),t._instance},t.prototype.init=function(t){this.timeDiff=Math.floor(Date.now()/1e3-t)},t.prototype.now=function(){return Math.floor(Date.now()/1e3)-this.timeDiff},t.prototype.nowMS=function(){return Date.now()-1e3*this.timeDiff},t.prototype.getLastDayOfWeekDate=function(t,e){e=e||5;var i=new Date(1e3*t),n=i.getDay(),r=e>n?e-n:7-(n-e);return new Date(i.getTime()+24*r*3600*1e3)},t.prototype.offsetDate=function(){var t=-21600,e=this.now();return e+=t,DateUtil.timeToChineseDate(e)},t.prototype.chineseDate=function(){return DateUtil.timeToChineseDate(this.now())},t.prototype.getNextDateTime=function(){return DateUtil.getNextDateTimeByHours(6)},t}();__reflect(TimeManager.prototype,"TimeManager");var UserManager=function(){function t(){this.isScope=!1}return t.getInstance=function(){return t._instance||(t._instance=new t),t._instance},t.prototype.fill=function(t){this.dbid=t._id,CarManager.getInstance().initData(t)},t.prototype.renewInfo=function(t){this.isScope=!0,this.nick=t.nickName,this.head=t.avatarUrl,this.gender=t.gender||1},t.prototype.getUserInfo=function(t){var e=this,i=window.wx,n=i.cloud.database();i.cloud.callFunction({name:"getInfo",complete:function(i){console.log(i),e.gameid=i.result.openid,n.collection("user").where({_openid:e.gameid}).get({success:function(i){return 0==i.data.length?void e.onNewUser(t):(e.testAddInvite(),e.fill(i.data[0]),void(t&&t()))}})}})},t.prototype.testAddInvite=function(){var t=window.wx,e=t.getLaunchOptionsSync().query;"1"==e.type&&t.cloud.callFunction({name:"onShareIn",data:{other:e.from,skinid:e.skinid},complete:function(t){}})},t.prototype.onNewUser=function(t){var e=this,i=window.wx,n=i.cloud.database(),r={skins:[1],skinid:1,skinsData:{},levelData:{}};n.collection("user").add({data:r,success:function(i){r._id=i._id,e.fill(r),t&&t()}}),this.testAddInvite()},t}();__reflect(UserManager.prototype,"UserManager");var DebugWXGameAD=function(){function t(){this.con=new eui.Rect}return t.prototype.createBannerAd=function(t,e,i){this.con.x=t,this.con.y=e,this.con.width=i,this.con.height=.35*i},t.prototype.hide=function(){MyTool.removeMC(this.con)},t.prototype.show=function(){GameManager.stage.addChild(this.con)},t.prototype.destroy=function(){this.hide()},t.prototype.offLoad=function(){},t.prototype.offError=function(){},t.prototype.setY=function(t){this.con.y=t},t}();__reflect(DebugWXGameAD.prototype,"DebugWXGameAD");var ADUI=function(){function t(){}return t.getADID=function(t){return this.adids[t]},Object.defineProperty(t,"isEnabled",{get:function(){return window.wx&&window.wx.createBannerAd?!0:!1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isEnabled",{get:function(){if(!t.isEnabled)return!1;try{var e=t.wx_banner_openids;if(e&&this.adindex)return e.indexOf(this.adindex)>=0}catch(i){}return!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"availWidth",{get:function(){return screen.availWidth},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"availHeight",{get:function(){return screen.availHeight},enumerable:!0,configurable:!0}),t.prototype.getDefault=function(e,i){void 0===i&&(i=540),this.adindex=e;var n=this.adid=t.adids[e]||t.wx_bannerCode,r=this.availWidth/640;300>i*r&&(i=300/r);var o=GameManager.uiHeight-i/640*224;return{id:n,btnw:i,btnx:(640-i)/2,btny:o}},t.prototype.addBannerBg=function(){this.bannerAdBg=new DebugWXGameAD},t.prototype.initSameAD=function(e,i,n){if(this.adindex=e,this.parentUI=i,t.bannerAd&&void 0!=n){var r=screen.availHeight/GameManager.stage.stageHeight;t.bannerAd.style.top=r*n}},t.prototype.init=function(e,i){if(this.isEnabled){this.parentUI=e;var n=i.btnw,r=i.btnx,o=i.btny,s=this.availWidth/640,a=this.availHeight/GameManager.stage.stageHeight,h=s*r,c=a*o,l=s*n;this.style={left:Math.floor(h),top:Math.floor(c),width:Math.floor(l)},t.bannerAd||this.createAD(i.id,h,c,l),this.autoChange=i.autoChange,this.isUI=i.isUI}},t.prototype.startChange=function(){},t.prototype.hide=function(){if(t.bannerAd&&(this.bannerAdBg&&this.bannerAdBg.hide(),t.bannerAd.now==this.parentUI))try{t.bannerAd.hide()}catch(e){console.log("error:",e)}},t.prototype.createAD=function(e,i,n,r){var o=this.availWidth/640,s=this.availHeight/GameManager.stage.stageHeight;this.bannerAdBg&&this.bannerAdBg.createBannerAd(i/o,n/s,r/o),t.bannerAd=window.wx.createBannerAd({adUnitId:e,style:{left:Math.floor(i),top:Math.floor(n),width:Math.ceil(r)}}),this.initTime=Date.now()},t.prototype.show=function(e){if(void 0===e&&(e=!1),this.isEnabled&&((e||this.initTime&&Date.now()-this.initTime>1e3*(t.wx_refushAD_time||30))&&(this.destroy(),this.createAD(this.adid,this.style.left,this.style.top,this.style.width)),t.bannerAd&&(t.bannerAd.show(),this.bannerAdBg&&this.bannerAdBg.show(),this.startChange(),t.bannerAd.now=this.parentUI,this.isUI))){t.bannerAd.style.top=this.style.top}},t.prototype.destroy=function(){if(t.bannerAd){try{t.bannerAd.destroy()}catch(e){console.log("error2:",e)}t.bannerAd=null,this.bannerAdBg&&this.bannerAdBg.destroy()}},t.prototype.checkShow=function(e){var i=e.data;if(i===!0||i!=this.parentUI){if(!t.bannerAd)return;if(t.bannerAd.now!=this.parentUI)return;try{t.bannerAd.hide()}catch(e){}this.bannerAdBg&&this.bannerAdBg.hide()}},t.prototype.checkHide=function(e){if(this.parentUI){var i=this.parentUI.parent;if(this.parentUI.stage&&i.getChildIndex(this.parentUI)==i.numChildren-1){if(!t.bannerAd)return;t.bannerAd.show(),this.bannerAdBg&&this.bannerAdBg.show(),t.bannerAd.now!=this.parentUI&&(t.bannerAd.now=this.parentUI),this.isUI&&this.show()}}},t.adids={},t}();__reflect(ADUI.prototype,"ADUI");var ShareTool=function(){function t(){}return t.share=function(t,e,i,n){var r=window.wx;console.log(t),console.log(e),console.log(ObjectUtil.join(i)),r.shareAppMessage({title:t,imageUrl:e,query:ObjectUtil.join(i)})},t.openGDTV=function(t,e,i,n){if(window.wx.createRewardedVideoAd||MyWindow.Alert("暂不支持视频广告"),!window.wx.isPlayAD){window.wx.isPlayAD=!0;var r=ADUI.getADID(i),o=window.wx.createRewardedVideoAd({adUnitId:r});o.load().then(function(){return o.show()})["catch"](function(e){o.offClose(s),t&&t(),window.wx.isPlayAD=!1});var s=function(i){!i||i.isEnded?t&&t():e&&e(),o.offClose(s),window.wx.isPlayAD=!1};o.onClose(s)}},t.canOpenGDTV=function(t){return window.wx&&null!=window.wx.createRewardedVideoAd},t.SHARE_KEYS=["ACT_TYPE","FROM_SERVER","FROM_USER","ACT_ITEMID","ACT_MODE","CHANGE_S"],t}();__reflect(ShareTool.prototype,"ShareTool");var ArrayUtil=function(){function t(){}return t.sortByField=function(t,e,i){function n(t,n){if(null!=t&&null!=n)for(e=r.slice(),i=o.slice();e.length>0;){if(t[e[0]]<n[e[0]])return 0==i[0]||-1==i[0]?-1:1;if(t[e[0]]>n[e[0]])return 0==i[0]||-1==i[0]?1:-1;e.shift(),i.shift()}return 0}if(t&&e&&i&&e.length==i.length){var r=e.slice(),o=i.slice();t.sort(n)}return t},t.randomOne=function(t,e){void 0===e&&(e=!1);var i=Math.floor(t.length*Math.random()),n=t[i];return e&&t.splice(i,1),n},t.removeItem=function(t,e){var i=t.indexOf(e);return-1==i?!1:(t.splice(i,1),!0)},t.random=function(t,e){function i(){return Math.random()>.5?-1:1}for(void 0===e&&(e=1);e--;)t.sort(i)},t.disposeList=function(t){if(t)for(var e=0;e<t.length;e++){var i=t[e];i.parent&&i.parent.removeChild(i),i.dispose()}t=[]},t.indexOfByKey=function(t,e,i){if(t){for(var n=0;n<t.length;n++){var r=t[n];if(r[e]==i)return n}return-1}return-1},t.indexOf=function(t,e,i){for(var n=0;n<t.length;n++)if(i){if(t[n][i]==e)return n}else if(t[n]==e)return n;return-1},t}();__reflect(ArrayUtil.prototype,"ArrayUtil");var Base64=function(){function t(){}return t.encode=function(e){var i,n,r,o,s,a,h,c="",l=0;for(e=t._utf8_encode(e);l<e.length;)i=e.charCodeAt(l++),n=e.charCodeAt(l++),r=e.charCodeAt(l++),o=i>>2,s=(3&i)<<4|n>>4,a=(15&n)<<2|r>>6,h=63&r,isNaN(n)?a=h=64:isNaN(r)&&(h=64),c=c+t._keyStr.charAt(o)+t._keyStr.charAt(s)+t._keyStr.charAt(a)+t._keyStr.charAt(h);return c},t.decode=function(e){var i,n,r,o,s,a,h,c="",l=0;for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");l<e.length;)o=t._keyStr.indexOf(e.charAt(l++)),s=t._keyStr.indexOf(e.charAt(l++)),a=t._keyStr.indexOf(e.charAt(l++)),h=t._keyStr.indexOf(e.charAt(l++)),i=o<<2|s>>4,n=(15&s)<<4|a>>2,r=(3&a)<<6|h,c+=String.fromCharCode(i),64!=a&&(c+=String.fromCharCode(n)),64!=h&&(c+=String.fromCharCode(r));return c=t._utf8_decode(c)},t._utf8_encode=function(t){t=t.replace(/\r\n/g,"\n");for(var e="",i=0;i<t.length;i++){var n=t.charCodeAt(i);128>n?e+=String.fromCharCode(n):n>127&&2048>n?(e+=String.fromCharCode(n>>6|192),e+=String.fromCharCode(63&n|128)):(e+=String.fromCharCode(n>>12|224),e+=String.fromCharCode(n>>6&63|128),e+=String.fromCharCode(63&n|128))}return e},t._utf8_decode=function(t){for(var e="",i=0,n=0,r=0,o=0;i<t.length;)n=t.charCodeAt(i),128>n?(e+=String.fromCharCode(n),i++):n>191&&224>n?(r=t.charCodeAt(i+1),e+=String.fromCharCode((31&n)<<6|63&r),i+=2):(r=t.charCodeAt(i+1),o=t.charCodeAt(i+2),e+=String.fromCharCode((15&n)<<12|(63&r)<<6|63&o),i+=3);return e},t._keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",t}();__reflect(Base64.prototype,"Base64");var DateUtil=function(){function t(){}return t.isSameWeek=function(e,i){return 0==Boolean(i)&&(i=TimeManager.getInstance().now()),0==t.getWeekDec(e,i)},t.timeToChineseDate=function(t){var e=new Date(1e3*t);return e.setMinutes(e.getMinutes()+480+e.getTimezoneOffset()),e},t.isSameDay=function(e,i,n){void 0===n&&(n=-1);var r=t.offsetTime;-1!=n&&(r=n),0==Boolean(i)&&(i=TimeManager.getInstance().now()),e-=r,i-=r;var o=t.timeToChineseDate(e),s=t.timeToChineseDate(i);return o.getDate()==s.getDate()&&o.getMonth()==s.getMonth()&&o.getFullYear()==s.getFullYear()?!0:!1},t.getDayDes=function(e,i){var n=t.offsetTime;i&&(n=0);var r=e+n,o=TimeManager.getInstance().now()+n,s=t.timeToChineseDate(r),a=t.timeToChineseDate(o);return r>=o?t.datediff(s,a):-t.datediff(a,s)},t.isThisDate=function(e){e+=t.offsetTime;var i=t.timeToChineseDate(e),n=t.timeToChineseDate(TimeManager.getInstance().now());return i.getDate()==n.getDate()},t.isThisMonth=function(e){var i=t.timeToChineseDate(e),n=t.timeToChineseDate(TimeManager.getInstance().now());return i.getMonth()==n.getMonth()},t.getStringBySecond=function(t){0>t&&(t=0);var e=Math.floor(t/3600),i=Math.floor(t%3600/60),n=Math.floor(t%60),r="",o=""+e;o.length<2&&(o="0"+o),r+=o;var s="0"+i;s=s.substr(s.length-2,2),r+=":"+s;var a="0"+n;return a=a.substr(a.length-2,2),r+=":"+a},t.datediff=function(t,e){if(null==t||null==e)return 0;var i=8+(new Date).getTimezoneOffset()/60;return t.setHours(0-i),t.setMinutes(0),t.setSeconds(0),t.setMilliseconds(0),e.setHours(0-i),e.setMinutes(0),e.setSeconds(0),e.setMilliseconds(0),(t.getTime()-e.getTime())/864e5},t.getWeekDec=function(e,i){function n(t,e,i,n,r){t.setDate(e),t.setHours(i),t.setMinutes(n),t.setSeconds(r)}var r=Math.min(e,i),o=Math.max(e,i),s=t.timeToChineseDate(r),a=t.timeToChineseDate(o),h=8+(new Date).getTimezoneOffset()/60,c=(s.getDay()||7)-1;n(s,s.getDate()-c,-h,0,0);var c=(a.getDay()||7)-1;return n(a,a.getDate()-c,-h,0,0),(a.getTime()-s.getTime())/24/3600/1e3/7},t.getNextDateTimeByHours=function(t){var e=TimeManager.getInstance().now(),i=new Date(1e3*e),n=-480-i.getTimezoneOffset(),r=60*(t-i.getHours())+n,o=r;return 0>=r&&(o+=1440),-1440>=r&&(o+=1440),i.setMinutes(o),i.setSeconds(0),Math.floor(i.getTime()/1e3)},t.getNextChineseDateByHours=function(t,e){return e=e||TimeManager.getInstance().chineseDate(),e.getHours()>=t&&e.setDate(e.getDate()+1),e.setHours(0),e.setMinutes(0),e.setSeconds(0),e},t.getStringBySeconds=function(e,i,n,r){0>e&&(e=0),i=i||!1,n=n||0,r=r||0;var o=e%60,s=Math.floor(e/60),a=Math.floor(s/1440),h=Math.floor(s/60)%24,c=s%60,l="";if(0!=a&&(l+=a+r+"天",i))return l;if(0!=h){if(l+=h+r+"小时",i)return l;if(2==n&&0!=a)return l}if(0!=c){if(i)return l+=c+r+"分钟";if(l+=c+r+"分",2==n&&0!=h)return l}if(0==a&&0==h||3==n){if(i&&1==n)return l=t.getStringBySecond(e),l.substr(-5);if(l+=o+"秒",i||3==n)return l;if(2==n&&0!=c)return l}return 0>o?"":l},t.getMonthWeek=function(t){var e=this.timeToChineseDate(t),i=e.getDay(),n=e.getDate();
return Math.ceil((n+6-i)/7)},t.getStringByDate=function(t,e){if(1==e){var i=""+t.getFullYear(),n="0"+(t.getMonth()+1),r="0"+t.getDate();return i+"-"+n.substr(n.length-2,2)+"-"+r.substr(r.length-2,2)}var i="0"+t.getHours(),n="0"+t.getMinutes(),r="0"+t.getSeconds();return i.substr(i.length-2,2)+":"+n.substr(n.length-2,2)+":"+r.substr(r.length-2,2)},t.StringToDate=function(t){if(null==t||""==t)return new Date;var e=t.split(" ");if(2!=e.length)return new Date;var i=e[0].split("-");if(3!=i.length)return new Date;var n=e[1].split(":");if(3!=n.length)return new Date;var r=new Date(i[0],i[1]-1,i[2],n[0],n[1],n[2]);return r},t.getTimestampByChineseDate=function(e){var i=t.StringToDate(e),n=-480-i.getTimezoneOffset();return i.setMinutes(i.getMinutes()-n),Math.floor(i.getTime()/1e3)},t.formatDate=function(t,e){var i={"M+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds(),"q+":Math.floor((e.getMonth()+3)/3),S:e.getMilliseconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(e.getFullYear()+"").substr(4-RegExp.$1.length)));for(var n in i)new RegExp("("+n+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?i[n]:("00"+i[n]).substr((""+i[n]).length)));return t},t.offsetTime=0,t}();__reflect(DateUtil.prototype,"DateUtil");var LoadingFile=function(){function t(){this.groupData={},this._loadingView=new LoadingUI}return t.getInstance=function(){return this.instance||(this.instance=new t),this.instance},t.prototype.loadGroup=function(t,e,i,n,r){this.loadtimer=egret.getTimer(),r=r||{},r.start=this.loadtimer,this.loadFiles=t,this.callBack=e,this.loadCount=t.length,this.callBack=e,this.callBackTarget=i,this.loadingData=r,this.loadingView=n||this._loadingView,this.loadingView.show(r),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),this.groupData={};for(var o=0;o<t.length;o++)this.groupData[t[o]]={current:0,total:RES.getGroupByName(t[o]).length},RES.loadGroup(t[o])},t.prototype.onResourceLoadComplete=function(t){if(-1!=this.loadFiles.indexOf(t.groupName)&&(this.loadCount--,0==this.loadCount)){RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this);var e=egret.getTimer()-this.loadtimer;this.loadingData.min&&e<this.loadingData.min?egret.setTimeout(function(){this.loadingView.hide(),this.callBack.call(this.callBackTarget)},this,this.loadingData.min-e):(this.loadingView.hide(),this.callBack.call(this.callBackTarget))}},t.prototype.onResourceLoadError=function(t){console.warn("Group:"+t.groupName+" has failed to load")},t.prototype.onResourceProgress=function(t){if(-1!=this.loadFiles.indexOf(t.groupName)){this.groupData[t.groupName].current=t.itemsLoaded;var e=0,i=0;for(var n in this.groupData)e+=this.groupData[n].current,i+=this.groupData[n].total;this.loadingView.setProgress(e,i)}},t}();__reflect(LoadingFile.prototype,"LoadingFile");var LoadingQueue=function(){function t(){this.loadCount=0,this.loaderList=[],this.loadReuslt=new Object}return t.prototype.load=function(t,e,i){this.loadFiles=t,this.callBack=e,this.callBack=e,this.callBackTarget=i,this.startLoad()},t.prototype.startLoad=function(){for(;this.loaderList.length<3&&this.loadCount<this.loadFiles.length;)this.loaderList.push(this.createLoader(this.loadFiles[this.loadCount])),this.loadCount++},t.prototype.createLoader=function(t){var e,i=new egret.URLLoader,n=t.substring(t.lastIndexOf(".")+1,t.length);switch(n){case"json":e=egret.URLLoaderDataFormat.TEXT;break;default:e=egret.URLLoaderDataFormat.TEXTURE}i.dataFormat=e,i.addEventListener(egret.Event.COMPLETE,this.onLoadComplete,this);var r=new egret.URLRequest(t);return i.load(r),i},t.prototype.onLoadComplete=function(t){var e=t.currentTarget,i=e._request.url,n=i.substring(i.lastIndexOf(".")+1,i.length);switch(n){case"json":this.loadReuslt[i]=JSON.parse(e.data);break;default:this.loadReuslt[i]=e.data}for(var r in this.loaderList)this.loaderList[r]==t.currentTarget&&this.loaderList[r].removeEventListener(egret.Event.COMPLETE,this.onLoadComplete,this);var o=ObjectUtil.objLength(this.loadReuslt);o==this.loadFiles.length?this.callBack.apply(this.callBackTarget,[this.loadReuslt]):this.startLoad()},t}();__reflect(LoadingQueue.prototype,"LoadingQueue");var md5=function(){function t(){this.hexcase=0,this.b64pad=""}return t.incode=function(e){return this.instance||(this.instance=new t),this.instance.hex_md5(e)},t.prototype.hex_md5=function(t){return this.rstr2hex(this.rstr_md5(this.str2rstr_utf8(t)))},t.prototype.b64_md5=function(t){return this.rstr2b64(this.rstr_md5(this.str2rstr_utf8(t)))},t.prototype.any_md5=function(t,e){return this.rstr2any(this.rstr_md5(this.str2rstr_utf8(t)),e)},t.prototype.hex_hmac_md5=function(t,e){return this.rstr2hex(this.rstr_hmac_md5(this.str2rstr_utf8(t),this.str2rstr_utf8(e)))},t.prototype.b64_hmac_md5=function(t,e){return this.rstr2b64(this.rstr_hmac_md5(this.str2rstr_utf8(t),this.str2rstr_utf8(e)))},t.prototype.any_hmac_md5=function(t,e,i){return this.rstr2any(this.rstr_hmac_md5(this.str2rstr_utf8(t),this.str2rstr_utf8(e)),i)},t.prototype.md5_vm_test=function(){return"900150983cd24fb0d6963f7d28e17f72"==this.hex_md5("abc").toLowerCase()},t.prototype.rstr_md5=function(t){return this.binl2rstr(this.binl_md5(this.rstr2binl(t),8*t.length))},t.prototype.rstr_hmac_md5=function(t,e){var i=this.rstr2binl(t);i.length>16&&(i=this.binl_md5(i,8*t.length));for(var n=Array(16),r=Array(16),o=0;16>o;o++)n[o]=909522486^i[o],r[o]=1549556828^i[o];var s=this.binl_md5(n.concat(this.rstr2binl(e)),512+8*e.length);return this.binl2rstr(this.binl_md5(r.concat(s),640))},t.prototype.rstr2hex=function(t){try{this.hexcase}catch(e){this.hexcase=0}for(var i,n=this.hexcase?"0123456789ABCDEF":"0123456789abcdef",r="",o=0;o<t.length;o++)i=t.charCodeAt(o),r+=n.charAt(i>>>4&15)+n.charAt(15&i);return r},t.prototype.rstr2b64=function(t){try{this.b64pad}catch(e){this.b64pad=""}for(var i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n="",r=t.length,o=0;r>o;o+=3)for(var s=t.charCodeAt(o)<<16|(r>o+1?t.charCodeAt(o+1)<<8:0)|(r>o+2?t.charCodeAt(o+2):0),a=0;4>a;a++)n+=8*o+6*a>8*t.length?this.b64pad:i.charAt(s>>>6*(3-a)&63);return n},t.prototype.rstr2any=function(t,e){var i,n,r,o,s,a=e.length,h=Array(Math.ceil(t.length/2));for(i=0;i<h.length;i++)h[i]=t.charCodeAt(2*i)<<8|t.charCodeAt(2*i+1);var c=Math.ceil(8*t.length/(Math.log(e.length)/Math.log(2))),l=Array(c);for(n=0;c>n;n++){for(s=Array(),o=0,i=0;i<h.length;i++)o=(o<<16)+h[i],r=Math.floor(o/a),o-=r*a,(s.length>0||r>0)&&(s[s.length]=r);l[n]=o,h=s}var u="";for(i=l.length-1;i>=0;i--)u+=e.charAt(l[i]);return u},t.prototype.str2rstr_utf8=function(t){for(var e,i,n="",r=-1;++r<t.length;)e=t.charCodeAt(r),i=r+1<t.length?t.charCodeAt(r+1):0,e>=55296&&56319>=e&&i>=56320&&57343>=i&&(e=65536+((1023&e)<<10)+(1023&i),r++),127>=e?n+=String.fromCharCode(e):2047>=e?n+=String.fromCharCode(192|e>>>6&31,128|63&e):65535>=e?n+=String.fromCharCode(224|e>>>12&15,128|e>>>6&63,128|63&e):2097151>=e&&(n+=String.fromCharCode(240|e>>>18&7,128|e>>>12&63,128|e>>>6&63,128|63&e));return n},t.prototype.str2rstr_utf16le=function(t){for(var e="",i=0;i<t.length;i++)e+=String.fromCharCode(255&t.charCodeAt(i),t.charCodeAt(i)>>>8&255);return e},t.prototype.str2rstr_utf16be=function(t){for(var e="",i=0;i<t.length;i++)e+=String.fromCharCode(t.charCodeAt(i)>>>8&255,255&t.charCodeAt(i));return e},t.prototype.rstr2binl=function(t){for(var e=Array(t.length>>2),i=0;i<e.length;i++)e[i]=0;for(var i=0;i<8*t.length;i+=8)e[i>>5]|=(255&t.charCodeAt(i/8))<<i%32;return e},t.prototype.binl2rstr=function(t){for(var e="",i=0;i<32*t.length;i+=8)e+=String.fromCharCode(t[i>>5]>>>i%32&255);return e},t.prototype.binl_md5=function(t,e){t[e>>5]|=128<<e%32,t[(e+64>>>9<<4)+14]=e;for(var i=1732584193,n=-271733879,r=-1732584194,o=271733878,s=0;s<t.length;s+=16){var a=i,h=n,c=r,l=o;i=this.md5_ff(i,n,r,o,t[s+0],7,-680876936),o=this.md5_ff(o,i,n,r,t[s+1],12,-389564586),r=this.md5_ff(r,o,i,n,t[s+2],17,606105819),n=this.md5_ff(n,r,o,i,t[s+3],22,-1044525330),i=this.md5_ff(i,n,r,o,t[s+4],7,-176418897),o=this.md5_ff(o,i,n,r,t[s+5],12,1200080426),r=this.md5_ff(r,o,i,n,t[s+6],17,-1473231341),n=this.md5_ff(n,r,o,i,t[s+7],22,-45705983),i=this.md5_ff(i,n,r,o,t[s+8],7,1770035416),o=this.md5_ff(o,i,n,r,t[s+9],12,-1958414417),r=this.md5_ff(r,o,i,n,t[s+10],17,-42063),n=this.md5_ff(n,r,o,i,t[s+11],22,-1990404162),i=this.md5_ff(i,n,r,o,t[s+12],7,1804603682),o=this.md5_ff(o,i,n,r,t[s+13],12,-40341101),r=this.md5_ff(r,o,i,n,t[s+14],17,-1502002290),n=this.md5_ff(n,r,o,i,t[s+15],22,1236535329),i=this.md5_gg(i,n,r,o,t[s+1],5,-165796510),o=this.md5_gg(o,i,n,r,t[s+6],9,-1069501632),r=this.md5_gg(r,o,i,n,t[s+11],14,643717713),n=this.md5_gg(n,r,o,i,t[s+0],20,-373897302),i=this.md5_gg(i,n,r,o,t[s+5],5,-701558691),o=this.md5_gg(o,i,n,r,t[s+10],9,38016083),r=this.md5_gg(r,o,i,n,t[s+15],14,-660478335),n=this.md5_gg(n,r,o,i,t[s+4],20,-405537848),i=this.md5_gg(i,n,r,o,t[s+9],5,568446438),o=this.md5_gg(o,i,n,r,t[s+14],9,-1019803690),r=this.md5_gg(r,o,i,n,t[s+3],14,-187363961),n=this.md5_gg(n,r,o,i,t[s+8],20,1163531501),i=this.md5_gg(i,n,r,o,t[s+13],5,-1444681467),o=this.md5_gg(o,i,n,r,t[s+2],9,-51403784),r=this.md5_gg(r,o,i,n,t[s+7],14,1735328473),n=this.md5_gg(n,r,o,i,t[s+12],20,-1926607734),i=this.md5_hh(i,n,r,o,t[s+5],4,-378558),o=this.md5_hh(o,i,n,r,t[s+8],11,-2022574463),r=this.md5_hh(r,o,i,n,t[s+11],16,1839030562),n=this.md5_hh(n,r,o,i,t[s+14],23,-35309556),i=this.md5_hh(i,n,r,o,t[s+1],4,-1530992060),o=this.md5_hh(o,i,n,r,t[s+4],11,1272893353),r=this.md5_hh(r,o,i,n,t[s+7],16,-155497632),n=this.md5_hh(n,r,o,i,t[s+10],23,-1094730640),i=this.md5_hh(i,n,r,o,t[s+13],4,681279174),o=this.md5_hh(o,i,n,r,t[s+0],11,-358537222),r=this.md5_hh(r,o,i,n,t[s+3],16,-722521979),n=this.md5_hh(n,r,o,i,t[s+6],23,76029189),i=this.md5_hh(i,n,r,o,t[s+9],4,-640364487),o=this.md5_hh(o,i,n,r,t[s+12],11,-421815835),r=this.md5_hh(r,o,i,n,t[s+15],16,530742520),n=this.md5_hh(n,r,o,i,t[s+2],23,-995338651),i=this.md5_ii(i,n,r,o,t[s+0],6,-198630844),o=this.md5_ii(o,i,n,r,t[s+7],10,1126891415),r=this.md5_ii(r,o,i,n,t[s+14],15,-1416354905),n=this.md5_ii(n,r,o,i,t[s+5],21,-57434055),i=this.md5_ii(i,n,r,o,t[s+12],6,1700485571),o=this.md5_ii(o,i,n,r,t[s+3],10,-1894986606),r=this.md5_ii(r,o,i,n,t[s+10],15,-1051523),n=this.md5_ii(n,r,o,i,t[s+1],21,-2054922799),i=this.md5_ii(i,n,r,o,t[s+8],6,1873313359),o=this.md5_ii(o,i,n,r,t[s+15],10,-30611744),r=this.md5_ii(r,o,i,n,t[s+6],15,-1560198380),n=this.md5_ii(n,r,o,i,t[s+13],21,1309151649),i=this.md5_ii(i,n,r,o,t[s+4],6,-145523070),o=this.md5_ii(o,i,n,r,t[s+11],10,-1120210379),r=this.md5_ii(r,o,i,n,t[s+2],15,718787259),n=this.md5_ii(n,r,o,i,t[s+9],21,-343485551),i=this.safe_add(i,a),n=this.safe_add(n,h),r=this.safe_add(r,c),o=this.safe_add(o,l)}return[i,n,r,o]},t.prototype.md5_cmn=function(t,e,i,n,r,o){return this.safe_add(this.bit_rol(this.safe_add(this.safe_add(e,t),this.safe_add(n,o)),r),i)},t.prototype.md5_ff=function(t,e,i,n,r,o,s){return this.md5_cmn(e&i|~e&n,t,e,r,o,s)},t.prototype.md5_gg=function(t,e,i,n,r,o,s){return this.md5_cmn(e&n|i&~n,t,e,r,o,s)},t.prototype.md5_hh=function(t,e,i,n,r,o,s){return this.md5_cmn(e^i^n,t,e,r,o,s)},t.prototype.md5_ii=function(t,e,i,n,r,o,s){return this.md5_cmn(i^(e|~n),t,e,r,o,s)},t.prototype.safe_add=function(t,e){var i=(65535&t)+(65535&e),n=(t>>16)+(e>>16)+(i>>16);return n<<16|65535&i},t.prototype.bit_rol=function(t,e){return t<<e|t>>>32-e},t}();__reflect(md5.prototype,"md5");var NumberUtil=function(){function t(){}return t.addNumSeparator=function(t,e){void 0===e&&(e=0);var i=String(t),n="";for(i.length<=3&&(n=i);i.length>3;)n=""==n?i.substr(-3):i.substr(-3)+","+n,i=i.substr(0,i.length-3),i.length<=3&&(n=i+","+n);if(e>0){var r=n.split(",");if(r.length>e){var o=r.length-e;r.length=e,n=r.join(",")+["K","M","G","T"][o-1]}}return n},t.numberWithCommas=function(t){if(t>=1e4)return t/1e4+"万";var e=t.toString().split(".");return e[0]=e[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),e.join(".")},t.formatStrNum=function(t){if(1e4>t)return""+t;for(var e,i=["K","M","G","T"],n=0;n<i.length;n++)if(e=t/Math.pow(1e3,n+1),1e3>e)return Math.floor(100*e)/100+i[n];return"999.9T+"},t}();__reflect(NumberUtil.prototype,"NumberUtil");var ObjectUtil=function(){function t(){}return t.join=function(t,e){void 0===e&&(e="&");var i=[];for(var n in t)i.push(n+"="+t[n]);return i.join(e)},t.arrayToObj=function(t,e,i){e=e||"key",i=i||"value";var n={};for(var r in t){var o=t[r];"@whole"==i?n[o[e]]=o:n[o[e]]=o[i]}return n},t.objToArray=function(t){var e=[];for(var i in t)e.push(t[i]);return e},t.objLength=function(t,e){var i=0;for(var n in t)(!e||t[n])&&i++;return i},t.clone=function(t){return JSON.parse(JSON.stringify(t))},t.addClickEvent=function(t,e,i){if(t){var n,r,o=function(e){n=e.stageX,r=e.stageY,t.addEventListener(egret.TouchEvent.TOUCH_END,s,i)},s=function(o){t.removeEventListener(egret.TouchEvent.TOUCH_END,s,i);var a,h;a=o.stageX,h=o.stageY,Math.abs(h-r)>10||Math.abs(a-n)>10||e&&e.apply(i,[o])};t.addEventListener(egret.TouchEvent.TOUCH_BEGIN,o,i),t.clickFun_touchBegin=o,t.clickFun_touchEnd=s}},t.removeClickEvent=function(t,e,i){t&&(t.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,t.clickFun_touchBegin,i),t.removeEventListener(egret.TouchEvent.TOUCH_END,t.clickFun_touchEnd,i))},t.swapKey=function(t,e,i){var n=t[e];t[e]=t[i],t[i]=n},t}();__reflect(ObjectUtil.prototype,"ObjectUtil");var PopUpManager=function(){function t(){}return t.movieChange=function(t,e,i){this.removeShape(),e.x=640*i,t.visible=!0,e.visible=!0,egret.Tween.removeTweens(t),egret.Tween.removeTweens(e);var n=egret.Tween.get(t);n.to({x:640*-i},300).call(function(){t.hide()},this);var n=egret.Tween.get(e);n.to({x:0},300)},t.removeShape=function(){MyTool.removeMC(this.shape)},t.addPopUp=function(t,e,i){function n(){t.removeEventListener(egret.Event.ENTER_FRAME,n,this);var e=(o-t.width)/2,a=(s-t.height)/2,h=(o-1.1*t.width)/2,c=(s-1.1*t.height)/2;if(t.alpha=1,t.visible=!0,i||r)t.scaleX=1,t.scaleY=1,t.x=e,t.y=a;else{t.alpha=0,t.scaleX=.6,t.scaleY=.6,t.x=(o-.6*t.width)/2,t.y=(s-.6*t.height)/2;var l=egret.Tween.get(t);l.to({alpha:1,scaleX:1.1,scaleY:1.1,x:h,y:c},150).to({scaleX:1,scaleY:1,x:e,y:a},150).call(function(){t.showFinish&&t.showFinish()})}}var r=t.stage&&t.visible,o=GameManager.container.width,s=GameManager.container.height;this.shape||(this.shape=new eui.Rect,this.shape.width=640,this.shape.fillColor=0,this.shape.fillAlpha=.8,this.shape.top=0,this.shape.bottom=0,this.shape.touchEnabled=!0,this.shape.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this));var a=this.shape;GameManager.container.addChild(a),GameManager.container.addChild(t),this.testVisible(),e&&(r||(t.alpha=0),t.addEventListener(egret.Event.ENTER_FRAME,n,this))},t.setMiddle=function(t){var e=GameManager.container.width,i=GameManager.container.height,n=(e-t.width)/2,r=(i-t.height)/2;t.x=n,t.y=r},t.onTap=function(){var t=this.shape.parent.getChildAt(this.shape.parent.numChildren-1);t.canBGClose&&t.hide()},t.removePopUp=function(t){if(t.parent){t.parent.getChildIndex(t);t.parent.removeChild(t),this.testShape(),this.testVisible()}},t.testShape=function(t){if(this.shape.parent||t){MyTool.removeMC(this.shape);for(var e=GameManager.container.numChildren-1;e>=0;e--){var i=GameManager.container.getChildAt(e);if(i instanceof game.BaseWindow)return void GameManager.container.addChildAt(this.shape,e)}}},t.testVisible=function(){for(var t=!1,e=GameManager.container.numChildren-1;e>=0;e--){var i=GameManager.container.getChildAt(e);if(i instanceof game.BaseUI){var n=i.visible;t?i.visible=!1:(i.visible=!0,!i.isWindow&&i.hideBehind&&(t=!0)),n!=i.visible&&i.onVisibleChange()}}},t.showToMain=function(){for(;;)for(var t=GameManager.container.numChildren-1;t>=0;t--){var e=GameManager.container.getChildAt(t);if(e instanceof game.BaseUI){e.hide();break}}},t.hideAll=function(){for(;;){for(var t=!1,e=GameManager.container.numChildren-1;e>=0;e--){var i=GameManager.container.getChildAt(e);if(i instanceof game.BaseUI){t=!0,i.hide();break}}if(!t)return}},t}();__reflect(PopUpManager.prototype,"PopUpManager");var StringUtil=function(){function t(){}return t.getString=function(t,e,i){if(void 0===i&&(i=!0),t&&e){var n=new eui.Label;n.size=e.size;var r=e.width;if(n.text=t,n.textWidth>r){n.text="";for(var o=0,s=t.length;s>o;o++){var a=t.substr(o,1);if(n.appendText(a),n.textWidth>r)return 0==i?t.substr(0,o):o>=2?t.substr(0,o-2)+"...":t}}}return t},t.getStringLength=function(t){return t.replace(/[^\x00-\xff]/g,"aa").length},t.getStringByLength=function(e,i){i=2*i;for(var n=1;n<=e.length;n++){var r=e.substr(0,n);if(t.getStringLength(r)>i)return e.substr(0,n-1)}return e},t.numToStr=function(t){return["零","一","二","三","四","五","六","七","八","九","十","十一","十二","十三","十四","十五","十六","十七","十八","十九","二十","二十一","二十二","二十三","二十四","二十五","二十六","二十七","二十八","二十九","三十","三十一","三十二","三十三","三十四","三十五","三十六","三十七","三十八","三十九","四十","四十一","四十二","四十三","四十四","四十五","四十六","四十七","四十八","四十九","五十","五十一","五十二","五十三","五十四","五十五","五十六","五十七","五十八","五十九","六十","六十一","六十二","六十三","六十四","六十五","六十六","六十七","六十八","六十九"][t]||t},t}();__reflect(StringUtil.prototype,"StringUtil"),window.Main=Main;